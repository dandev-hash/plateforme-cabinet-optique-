<template>
  <div class="min-h-screen bg-gradient-to-br from-gray-50 via-gray-100 to-slate-100 relative overflow-hidden">
    <!-- Header Section -->
    <div class="bg-white border-b border-green-100 py-6 sm:py-8 relative z-10 overflow-hidden">
      <!-- Cercles d√©coratifs de l'en-t√™te -->
      <div class="absolute inset-0 overflow-hidden pointer-events-none">
        <!-- Gros cercle noir qui recouvre les premi√®res lettres -->
        <div
          class="absolute -top-20 -left-20 w-[280px] h-[280px] bg-black/15 rounded-full opacity-70 animate-float-slow">
        </div>

        <!-- Cercles d'accent -->
        <div class="absolute top-10 left-1/3 w-32 h-32 bg-green-200 rounded-full opacity-50 animate-float"></div>
        <div
          class="absolute -bottom-10 left-1/4 w-40 h-40 bg-emerald-100 rounded-full opacity-60 animate-float-delayed">
        </div>
        <div class="absolute top-1/2 right-20 w-24 h-24 bg-gray-200 rounded-full opacity-55 animate-float-slow"></div>
        <div class="absolute -top-5 right-1/4 w-36 h-36 bg-black/10 rounded-full opacity-50 animate-float"></div>
        <div class="absolute bottom-0 right-10 w-28 h-28 bg-green-100 rounded-full opacity-60 animate-float-delayed">
        </div>
      </div>

      <div class="max-w-7xl mx-auto px-4 relative z-10">
        <div class="flex items-center justify-between gap-4">
          <div class="flex-1">
            <h1 class="text-6xl sm:text-7xl font-extrabold text-green-900 tracking-tight mb-2"
              style="font-family: 'Montserrat', sans-serif;">Quiz & Conseils</h1>
            <p class="text-gray-600 text-lg">D√©couvrez vos besoins visuels avec nos tests personnalis√©s.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Separator line -->
    <div class="w-full h-0.5 bg-green-600"></div>

    <!-- Navigation Section -->
    <div class="relative bg-gradient-to-br from-gray-900 via-green-800 to-black text-white overflow-hidden py-8">
      <div class="absolute inset-0 overflow-hidden opacity-20">
        <div class="absolute top-0 left-0 w-96 h-96 bg-green-500/30 rounded-full blur-3xl animate-blob"></div>
        <div
          class="absolute top-1/2 right-0 w-96 h-96 bg-emerald-500/30 rounded-full blur-3xl animate-blob animation-delay-2000">
        </div>
      </div>

      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
        <div class="flex flex-wrap justify-center items-center gap-30">
          <a href="#quiz-section"
            class="px-6 py-3 bg-white/10 hover:bg-white/20 border border-white/30 rounded-lg text-white font-semibold transition-all duration-300 hover:scale-105 backdrop-blur-sm">
            Effectuer un test
          </a>
          <a href="#quiz-section"
            class="px-6 py-3 bg-white/10 hover:bg-white/20 border border-white/30 rounded-lg text-white font-semibold transition-all duration-300 hover:scale-105 backdrop-blur-sm">
            Effectuer un quiz
          </a>
          <a href="#conseils-section"
            class="px-6 py-3 bg-white/10 hover:bg-white/20 border border-white/30 rounded-lg text-white font-semibold transition-all duration-300 hover:scale-105 backdrop-blur-sm">
            Conseils personnalis√©s
          </a>
        </div>
      </div>

      <div class="absolute bottom-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-green-400 to-transparent">
      </div>
    </div>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-12 -mt-8 relative z-10">

      <!-- Section de s√©lection : Quiz & Tests -->
      <div id="quiz-section" class="grid grid-cols-1 md:grid-cols-2 gap-10 mb-12 scroll-mt-20">

        <!-- Carte Quiz -->
        <div @click="openQuizModal"
          class="group relative bg-gradient-to-br from-white/40 via-emerald-100/20 to-green-100/30 rounded-3xl shadow-lg overflow-hidden border border-white/40 cursor-pointer transform hover:scale-[1.03] hover:-translate-y-1 transition-all duration-500 hover:shadow-2xl">
          <!-- Motifs anim√©s -->
          <div class="absolute inset-0 opacity-60 pointer-events-none">
            <svg class="absolute top-0 left-0 w-full h-full">
              <rect x="8%" y="12%" width="50" height="50" fill="none" stroke="#10b981" stroke-width="1.5" opacity="0.5">
                <animateTransform attributeName="transform" type="rotate" from="0 10 10" to="360 10 10" dur="4s"
                  repeatCount="indefinite" />
                <animate attributeName="opacity" from="0.6" to="0.2" dur="2s" repeatCount="indefinite" />
              </rect>
              <rect x="25%" y="8%" width="40" height="40" fill="none" stroke="#14b8a6" stroke-width="1" opacity="0.4">
                <animateTransform attributeName="transform" type="rotate" from="0 27 10" to="-360 27 10" dur="5s"
                  repeatCount="indefinite" />
                <animate attributeName="opacity" from="0.5" to="0.1" dur="2.3s" repeatCount="indefinite" />
              </rect>
              <polygon points="85,15 92,30 85,45 78,30" fill="none" stroke="#14b8a6" stroke-width="1.5" opacity="0.5"
                transform="translate(65%, 20%)">
                <animateTransform attributeName="transform" type="rotate" from="0 85 30" to="360 85 30" dur="3.5s"
                  repeatCount="indefinite" additive="sum" />
                <animate attributeName="opacity" from="0.6" to="0.2" dur="2.5s" repeatCount="indefinite" />
              </polygon>
              <polygon points="10,5 18,12 15,22 7,18" fill="none" stroke="#059669" stroke-width="1" opacity="0.4"
                transform="translate(78%, 12%)">
                <animateTransform attributeName="transform" type="rotate" from="0 13 14" to="-360 13 14" dur="4.5s"
                  repeatCount="indefinite" additive="sum" />
                <animate attributeName="opacity" from="0.5" to="0.1" dur="2.2s" repeatCount="indefinite" />
              </polygon>
              <line x1="35%" y1="35%" x2="50%" y2="50%" stroke="#059669" stroke-width="2" opacity="0.5">
                <animate attributeName="opacity" from="0.6" to="0.1" dur="1.8s" repeatCount="indefinite" />
                <animateTransform attributeName="transform" type="rotate" from="0 42 42" to="360 42 42" dur="6s"
                  repeatCount="indefinite" />
              </line>
              <line x1="35%" y1="50%" x2="50%" y2="35%" stroke="#059669" stroke-width="2" opacity="0.5">
                <animate attributeName="opacity" from="0.6" to="0.1" dur="1.8s" repeatCount="indefinite" />
                <animateTransform attributeName="transform" type="rotate" from="0 42 42" to="360 42 42" dur="6s"
                  repeatCount="indefinite" />
              </line>
              <line x1="55%" y1="40%" x2="68%" y2="55%" stroke="#10b981" stroke-width="1.5" opacity="0.4">
                <animate attributeName="opacity" from="0.5" to="0.1" dur="2.2s" repeatCount="indefinite" />
                <animateTransform attributeName="transform" type="rotate" from="0 61 47" to="-360 61 47" dur="7s"
                  repeatCount="indefinite" />
              </line>
              <polygon points="0,0 20,8 16,28 -4,20" fill="none" stroke="#10b981" stroke-width="1.5" opacity="0.5"
                transform="translate(12%, 68%)">
                <animate attributeName="opacity" from="0.6" to="0.2" dur="2.3s" repeatCount="indefinite" />
                <animateTransform attributeName="transform" type="scale" from="1" to="1.4" dur="3.5s"
                  repeatCount="indefinite" additive="sum" />
              </polygon>
              <rect x="30%" y="70%" width="45" height="45" fill="none" stroke="#059669" stroke-width="1" opacity="0.4"
                rx="6">
                <animateTransform attributeName="transform" type="rotate" from="0 32 72" to="360 32 72" dur="5.5s"
                  repeatCount="indefinite" />
                <animate attributeName="opacity" from="0.5" to="0.1" dur="2.6s" repeatCount="indefinite" />
              </rect>
              <rect x="70%" y="60%" width="50" height="50" fill="none" stroke="#14b8a6" stroke-width="1.5" opacity="0.4"
                rx="8">
                <animateTransform attributeName="transform" type="rotate" from="0 72 62" to="-360 72 62" dur="5s"
                  repeatCount="indefinite" />
                <animate attributeName="opacity" from="0.5" to="0.1" dur="2.5s" repeatCount="indefinite" />
              </rect>
              <polygon points="5,0 15,5 12,18 2,13" fill="none" stroke="#10b981" stroke-width="1" opacity="0.4"
                transform="translate(55%, 75%)">
                <animateTransform attributeName="transform" type="rotate" from="0 8 9" to="360 8 9" dur="4s"
                  repeatCount="indefinite" additive="sum" />
                <animate attributeName="opacity" from="0.5" to="0.1" dur="2.4s" repeatCount="indefinite" />
              </polygon>
              <line x1="18%" y1="45%" x2="28%" y2="58%" stroke="#14b8a6" stroke-width="1.5" opacity="0.4">
                <animate attributeName="opacity" from="0.5" to="0.1" dur="2s" repeatCount="indefinite" />
                <animateTransform attributeName="transform" type="rotate" from="0 23 51" to="360 23 51" dur="6.5s"
                  repeatCount="indefinite" />
              </line>
              <polygon points="8,3 14,10 10,20 4,13" fill="none" stroke="#059669" stroke-width="1" opacity="0.4"
                transform="translate(82%, 45%)">
                <animateTransform attributeName="transform" type="rotate" from="0 9 11" to="-360 9 11" dur="4.8s"
                  repeatCount="indefinite" additive="sum" />
                <animate attributeName="opacity" from="0.5" to="0.1" dur="2.1s" repeatCount="indefinite" />
              </polygon>
            </svg>
          </div>
          <div
            class="absolute top-0 right-0 w-72 h-72 bg-gradient-to-bl from-green-400/10 via-emerald-400/5 to-transparent rounded-full blur-3xl group-hover:scale-110 transition-transform duration-700">
          </div>
          <div
            class="absolute bottom-0 left-0 w-64 h-64 bg-gradient-to-tr from-teal-400/10 via-green-400/5 to-transparent rounded-full blur-3xl group-hover:scale-110 transition-transform duration-700">
          </div>

          <div class="relative p-10 overflow-hidden">
            <div
              class="absolute inset-0 bg-gradient-to-r from-transparent via-white/50 to-transparent animate-shimmer opacity-0 group-hover:opacity-100 transition-opacity">
            </div>

            <div class="relative z-10 text-center space-y-4">
              <div
                class="inline-flex items-center justify-center w-24 h-24 bg-gradient-to-br from-green-500 via-emerald-500 to-teal-600 rounded-3xl mb-2 shadow-xl group-hover:shadow-2xl transition-all duration-300 group-hover:rotate-3 group-hover:scale-110">
                <span class="text-6xl">üìã</span>
              </div>

              <div>
                <h3
                  class="text-3xl font-extrabold bg-gradient-to-r from-gray-900 via-green-800 to-emerald-900 bg-clip-text text-transparent mb-3">
                  Quiz Diagnostic Visuel</h3>
                <p class="text-gray-600 text-base leading-relaxed max-w-sm mx-auto">Obtenez des recommandations
                  personnalis√©es selon vos besoins</p>
              </div>

              <div
                class="pt-4 inline-flex items-center gap-2 text-green-700 text-sm font-bold group-hover:gap-4 transition-all">
                <span>Commencer le diagnostic</span>
                <svg class="w-5 h-5 group-hover:translate-x-2 transition-transform duration-300" fill="currentColor"
                  viewBox="0 0 20 20">
                  <path fill-rule="evenodd"
                    d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z"
                    clip-rule="evenodd" />
                </svg>
              </div>
            </div>
          </div>
        </div>

        <!-- Carte Tests -->
        <div @click="openTestModal"
          class="group relative bg-gradient-to-br from-white/40 via-blue-100/20 to-indigo-100/30 rounded-3xl shadow-lg overflow-hidden border border-white/40 cursor-pointer transform hover:scale-[1.03] hover:-translate-y-1 transition-all duration-500 hover:shadow-2xl">
          <!-- Motifs anim√©s -->
          <div class="absolute inset-0 opacity-60 pointer-events-none">
            <svg class="absolute top-0 left-0 w-full h-full">
              <polygon points="18,8 26,20 18,32 10,20" fill="none" stroke="#3b82f6" stroke-width="1.5" opacity="0.5"
                transform="translate(12%, 10%)">
                <animateTransform attributeName="transform" type="rotate" from="0 18 20" to="360 18 20" dur="5s"
                  repeatCount="indefinite" additive="sum" />
                <animate attributeName="opacity" from="0.6" to="0.2" dur="2.5s" repeatCount="indefinite" />
              </polygon>
              <polygon points="8,4 14,12 10,22 4,14" fill="none" stroke="#6366f1" stroke-width="1" opacity="0.4"
                transform="translate(28%, 8%)">
                <animateTransform attributeName="transform" type="rotate" from="0 9 13" to="-360 9 13" dur="4.2s"
                  repeatCount="indefinite" additive="sum" />
                <animate attributeName="opacity" from="0.5" to="0.1" dur="2.2s" repeatCount="indefinite" />
              </polygon>
              <rect x="70%" y="15%" width="55" height="55" fill="none" stroke="#8b5cf6" stroke-width="1.5" opacity="0.5"
                rx="8">
                <animateTransform attributeName="transform" type="rotate" from="0 72 17" to="-360 72 17" dur="4s"
                  repeatCount="indefinite" />
                <animate attributeName="opacity" from="0.6" to="0.2" dur="2s" repeatCount="indefinite" />
              </rect>
              <rect x="82%" y="8%" width="40" height="40" fill="none" stroke="#3b82f6" stroke-width="1" opacity="0.4"
                rx="5">
                <animateTransform attributeName="transform" type="rotate" from="0 84 10" to="360 84 10" dur="5.5s"
                  repeatCount="indefinite" />
                <animate attributeName="opacity" from="0.5" to="0.1" dur="2.3s" repeatCount="indefinite" />
              </rect>
              <path d="M 35,40 L 43,40 L 47,48 L 43,56 L 35,56 L 31,48 Z" fill="none" stroke="#6366f1" stroke-width="2"
                opacity="0.5" transform="translate(8%, 8%)">
                <animateTransform attributeName="transform" type="rotate" from="0 39 48" to="360 39 48" dur="6s"
                  repeatCount="indefinite" additive="sum" />
                <animate attributeName="opacity" from="0.6" to="0.2" dur="3s" repeatCount="indefinite" />
              </path>
              <path d="M 10,8 L 16,8 L 19,14 L 16,20 L 10,20 L 7,14 Z" fill="none" stroke="#8b5cf6" stroke-width="1"
                opacity="0.4" transform="translate(55%, 25%)">
                <animateTransform attributeName="transform" type="rotate" from="0 13 14" to="-360 13 14" dur="5.2s"
                  repeatCount="indefinite" additive="sum" />
                <animate attributeName="opacity" from="0.5" to="0.1" dur="2.4s" repeatCount="indefinite" />
              </path>
              <polygon points="0,0 28,0 28,28 0,28" fill="none" stroke="#3b82f6" stroke-width="1.5" opacity="0.5"
                transform="translate(8%, 65%)">
                <animateTransform attributeName="transform" type="scale" from="1" to="1.3" dur="3.5s"
                  repeatCount="indefinite" additive="sum" />
                <animate attributeName="opacity" from="0.6" to="0.2" dur="2.5s" repeatCount="indefinite" />
              </polygon>
              <rect x="32%" y="72%" width="42" height="42" fill="none" stroke="#6366f1" stroke-width="1" opacity="0.4"
                rx="6">
                <animateTransform attributeName="transform" type="rotate" from="0 34 74" to="360 34 74" dur="4.8s"
                  repeatCount="indefinite" />
                <animate attributeName="opacity" from="0.5" to="0.1" dur="2.6s" repeatCount="indefinite" />
              </rect>
              <line x1="68%" y1="62%" x2="82%" y2="78%" stroke="#8b5cf6" stroke-width="2" opacity="0.5">
                <animate attributeName="opacity" from="0.6" to="0.1" dur="2s" repeatCount="indefinite" />
                <animateTransform attributeName="transform" type="rotate" from="0 75 70" to="360 75 70" dur="5s"
                  repeatCount="indefinite" />
              </line>
              <line x1="68%" y1="78%" x2="82%" y2="62%" stroke="#8b5cf6" stroke-width="2" opacity="0.5">
                <animate attributeName="opacity" from="0.6" to="0.1" dur="2s" repeatCount="indefinite" />
                <animateTransform attributeName="transform" type="rotate" from="0 75 70" to="360 75 70" dur="5s"
                  repeatCount="indefinite" />
              </line>
              <line x1="50%" y1="55%" x2="62%" y2="68%" stroke="#6366f1" stroke-width="1.5" opacity="0.4">
                <animate attributeName="opacity" from="0.5" to="0.1" dur="2.3s" repeatCount="indefinite" />
                <animateTransform attributeName="transform" type="rotate" from="0 56 61" to="-360 56 61" dur="6.5s"
                  repeatCount="indefinite" />
              </line>
              <polygon points="6,2 12,8 9,16 3,10" fill="none" stroke="#3b82f6" stroke-width="1" opacity="0.4"
                transform="translate(48%, 12%)">
                <animateTransform attributeName="transform" type="rotate" from="0 7 9" to="360 7 9" dur="4.5s"
                  repeatCount="indefinite" additive="sum" />
                <animate attributeName="opacity" from="0.5" to="0.1" dur="2.1s" repeatCount="indefinite" />
              </polygon>
              <rect x="58%" y="75%" width="35" height="35" fill="none" stroke="#8b5cf6" stroke-width="1" opacity="0.4"
                rx="4">
                <animateTransform attributeName="transform" type="rotate" from="0 60 77" to="-360 60 77" dur="5.8s"
                  repeatCount="indefinite" />
                <animate attributeName="opacity" from="0.5" to="0.1" dur="2.7s" repeatCount="indefinite" />
              </rect>
            </svg>
          </div>
          <div
            class="absolute top-0 right-0 w-72 h-72 bg-gradient-to-bl from-blue-400/10 via-indigo-400/5 to-transparent rounded-full blur-3xl group-hover:scale-110 transition-transform duration-700">
          </div>
          <div
            class="absolute bottom-0 left-0 w-64 h-64 bg-gradient-to-tr from-purple-400/10 via-blue-400/5 to-transparent rounded-full blur-3xl group-hover:scale-110 transition-transform duration-700">
          </div>

          <div class="relative p-10 overflow-hidden">
            <div
              class="absolute inset-0 bg-gradient-to-r from-transparent via-white/50 to-transparent animate-shimmer opacity-0 group-hover:opacity-100 transition-opacity"
              style="animation-delay: 0.3s;"></div>

            <div class="relative z-10 text-center space-y-4">
              <div
                class="inline-flex items-center justify-center w-24 h-24 bg-gradient-to-br from-blue-500 via-indigo-500 to-purple-600 rounded-3xl mb-2 shadow-xl group-hover:shadow-2xl transition-all duration-300 group-hover:rotate-3 group-hover:scale-110">
                <span class="text-6xl">üî¨</span>
              </div>

              <div>
                <h3
                  class="text-3xl font-extrabold bg-gradient-to-r from-gray-900 via-blue-800 to-indigo-900 bg-clip-text text-transparent mb-3">
                  Tests Visuels Interactifs</h3>
                <p class="text-gray-600 text-base leading-relaxed max-w-sm mx-auto">√âvaluez votre sant√© oculaire avec
                  nos outils de d√©pistage</p>
              </div>

              <div
                class="pt-4 inline-flex items-center gap-2 text-indigo-700 text-sm font-bold group-hover:gap-4 transition-all">
                <span>Lancer un test</span>
                <svg class="w-5 h-5 group-hover:translate-x-2 transition-transform duration-300" fill="currentColor"
                  viewBox="0 0 20 20">
                  <path fill-rule="evenodd"
                    d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z"
                    clip-rule="evenodd" />
                </svg>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Section Quiz/Test + FAQ - Pleine largeur -->
    <div class="w-full px-4 sm:px-6 lg:px-8 py-8">
      <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">

        <!-- Colonne Gauche : Quiz OU Test -->
        <div id="quiz-test-section" class="lg:col-span-3 scroll-mt-20">
          <div class="bg-white rounded-3xl shadow-2xl overflow-hidden border border-gray-100">

            <!-- En-t√™te Quiz -->
            <div v-if="selectedQuizType && !selectedTestType"
              class="relative bg-gradient-to-br from-green-900 via-green-800 to-emerald-900 p-8 overflow-hidden">
              <div
                class="absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent animate-shimmer">
              </div>
              <div class="absolute inset-0 opacity-10"
                style="background-image: radial-gradient(circle, white 1px, transparent 1px); background-size: 20px 20px;">
              </div>

              <div class="relative z-10">
                <h2 class="text-3xl font-bold text-white flex items-center gap-3 drop-shadow-lg">
                  <span class="text-4xl">{{ selectedQuizType.icon }}</span>
                  {{ selectedQuizType.title }}
                </h2>
                <p class="text-green-100 mt-2">{{ selectedQuizType.description }}</p>
                <div class="flex gap-4 mt-3 text-sm text-green-200">
                  <span>üìã {{ selectedQuizType.questionCount }} questions</span>
                  <span>‚è±Ô∏è {{ selectedQuizType.duration }}</span>
                </div>
              </div>
            </div>

            <!-- En-t√™te Test -->
            <div v-else-if="selectedTestType"
              class="relative bg-gradient-to-br from-blue-900 via-indigo-800 to-purple-900 p-8 overflow-hidden">
              <div
                class="absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent animate-shimmer">
              </div>
              <div class="absolute inset-0 opacity-10"
                style="background-image: radial-gradient(circle, white 1px, transparent 1px); background-size: 20px 20px;">
              </div>

              <div class="relative z-10">
                <h2 class="text-3xl font-bold text-white flex items-center gap-3 drop-shadow-lg">
                  <span class="text-4xl">{{ selectedTestType.icon }}</span>
                  {{ selectedTestType.title }}
                </h2>
                <p class="text-blue-100 mt-2">{{ selectedTestType.description }}</p>
                <div class="flex gap-4 mt-3 text-sm text-blue-200">
                  <span>üìã {{ selectedTestType.stepCount }} √©tapes</span>
                  <span>‚è±Ô∏è {{ selectedTestType.duration }}</span>
                </div>
              </div>
            </div>

            <!-- En-t√™te par d√©faut -->
            <div v-else class="relative bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 p-8 overflow-hidden">
              <div
                class="absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent animate-shimmer">
              </div>
              <div class="absolute inset-0 opacity-10"
                style="background-image: radial-gradient(circle, white 1px, transparent 1px); background-size: 20px 20px;">
              </div>

              <div class="relative z-10">
                <h2 class="text-3xl font-bold text-white flex items-center gap-3 drop-shadow-lg">
                  <span class="text-4xl">üìã</span>
                  S√©lectionnez un Quiz ou Test
                </h2>
                <p class="text-gray-300 mt-2">Choisissez un quiz pour des r√©sultats instantan√©s ou un test m√©dical
                  approfondi</p>
              </div>
            </div>

            <!-- Corps du questionnaire -->
            <div class="p-8">
              <!-- Message de s√©lection -->
              <div v-if="!selectedQuizType && !selectedTestType" class="text-center py-12">
                <div class="inline-flex items-center justify-center w-24 h-24 bg-gray-100 rounded-full mb-6">
                  <span class="text-6xl">üéØ</span>
                </div>
                <h3 class="text-2xl font-bold text-gray-900 mb-4">Commencez par choisir</h3>
                <p class="text-gray-600 mb-8">Cliquez sur les cartes ci-dessus pour s√©lectionner un quiz rapide ou un
                  test m√©dical</p>
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                  <button @click="openQuizModal"
                    class="px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-xl transition-all">
                    Choisir un Quiz
                  </button>
                  <button @click="openTestModal"
                    class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-xl transition-all">
                    Choisir un Test
                  </button>
                </div>
              </div>

              <!-- Formulaire d'inscription pour Test -->
              <div v-else-if="selectedTestType && !testFormSubmitted" class="space-y-6">
                <div class="bg-blue-50 border-l-4 border-blue-500 p-6 rounded-r-xl">
                  <div class="flex items-start gap-3">
                    <span class="text-3xl">‚ÑπÔ∏è</span>
                    <div>
                      <h3 class="font-bold text-blue-900 mb-2">Test M√©dical Approfondi</h3>
                      <p class="text-blue-800 text-sm leading-relaxed">
                        Ce test n√©cessite une analyse d√©taill√©e et rigoureuse. Commencez par renseigner vos
                        informations,
                        puis effectuez le test. Les r√©sultats vous seront envoy√©s par email dans un d√©lai de <strong>24
                          √† 48 heures</strong>.
                      </p>
                    </div>
                  </div>
                </div>

                <form @submit.prevent="submitTestForm" class="space-y-6">
                  <!-- Nom complet -->
                  <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">
                      Nom Complet <span class="text-red-500">*</span>
                    </label>
                    <input v-model="testFormData.name" type="text" required placeholder="Jean Dupont"
                      class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-600 focus:ring-2 focus:ring-blue-200 transition-all outline-none">
                  </div>

                  <!-- Email -->
                  <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">
                      Adresse Email <span class="text-red-500">*</span>
                    </label>
                    <input v-model="testFormData.email" @blur="validateEmail" type="email" required
                      placeholder="jean.dupont@example.com" :class="[
                        'w-full px-4 py-3 border-2 rounded-xl focus:ring-2 focus:ring-blue-200 transition-all outline-none',
                        emailError ? 'border-red-500 focus:border-red-600' : 'border-gray-200 focus:border-blue-600'
                      ]">
                    <p v-if="emailError" class="text-xs text-red-500 mt-2">{{ emailError }}</p>
                    <p v-else class="text-xs text-gray-500 mt-2">üìß Les r√©sultats seront envoy√©s √† cette adresse</p>
                  </div>

                  <!-- T√©l√©phone -->
                  <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">
                      T√©l√©phone <span class="text-gray-400">(optionnel)</span>
                    </label>
                    <input v-model="testFormData.phone" type="tel" placeholder="+221 XX XXX XX XX"
                      class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-600 focus:ring-2 focus:ring-blue-200 transition-all outline-none">
                  </div>

                  <!-- Boutons -->
                  <div class="flex gap-3 pt-4">
                    <button type="submit" :disabled="!isFormValid"
                      class="flex-1 py-4 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-bold text-lg rounded-xl transition-all duration-300 disabled:from-gray-300 disabled:to-gray-400 disabled:cursor-not-allowed shadow-lg hover:shadow-xl transform hover:scale-[1.02] disabled:transform-none">
                      <span v-if="isFormValid">‚ñ∂Ô∏è Commencer le Test</span>
                      <span v-else>‚ö†Ô∏è Remplissez les champs obligatoires</span>
                    </button>
                    <button type="button" @click="resetTestSelection"
                      class="px-6 py-4 bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold rounded-xl transition-all">
                      Annuler
                    </button>
                  </div>
                </form>
              </div>

              <!-- Contenu du Test (apr√®s soumission du formulaire) -->
              <div v-else-if="selectedTestType && testFormSubmitted && !testCompleted" class="space-y-6">
                <div class="bg-blue-50 border border-blue-200 p-5 rounded-lg mb-6">
                  <div class="flex items-start gap-3">
                    <span class="text-2xl">‚ÑπÔ∏è</span>
                    <div>
                      <h3 class="font-semibold text-blue-900 mb-1">Informations enregistr√©es</h3>
                      <p class="text-blue-800 text-sm">Les r√©sultats seront envoy√©s √† <strong>{{ testFormData.email
                          }}</strong></p>
                    </div>
                  </div>
                </div>

                <!-- Indicateur de progression du test -->
                <div :class="[
                  'bg-white rounded-lg p-4 border-2 transition-all duration-300',
                  currentTestStep === selectedTestType.stepCount - 1
                    ? 'border-green-500 bg-green-50'
                    : 'border-gray-300'
                ]">
                  <div class="flex items-center justify-between mb-2">
                    <span class="text-sm font-semibold text-gray-700">Progression du test</span>
                    <span :class="[
                      'text-sm font-semibold',
                      currentTestStep === selectedTestType.stepCount - 1 ? 'text-green-600' : 'text-blue-600'
                    ]">
                      {{ currentTestStep === selectedTestType.stepCount - 1 ? 'üèÅ Derni√®re √©tape !' : `√âtape
                      ${currentTestStep + 1} / ${selectedTestType.stepCount}` }}
                    </span>
                  </div>
                  <div class="w-full bg-gray-200 rounded-full h-2 overflow-hidden">
                    <div :class="[
                      'h-2 rounded-full transition-all duration-500',
                      currentTestStep === selectedTestType.stepCount - 1 ? 'bg-green-600' : 'bg-blue-600'
                    ]" :style="{ width: `${((currentTestStep + 1) / selectedTestType.stepCount) * 100}%` }"></div>
                  </div>
                </div>

                <!-- Contenu du test -->
                <div class="bg-white border border-gray-300 rounded-lg p-8">
                  <!-- En-t√™te de l'√©tape -->
                  <div class="mb-6 pb-4 border-b border-gray-200">
                    <div class="flex items-center gap-3 mb-2">
                      <span class="text-3xl">{{ selectedTestType.icon }}</span>
                      <h3 class="text-2xl font-semibold text-gray-900">{{ getCurrentTestStep().title }}</h3>
                    </div>
                    <p class="text-gray-600 text-sm">{{ getCurrentTestStep().instruction }}</p>
                  </div>

                  <!-- Contenu de l'√©tape -->
                  <Transition name="test-step" mode="out-in">
                    <div :key="currentTestStep" class="min-h-[300px]">
                      <!-- Test d'Acuit√© Visuelle -->
                      <div v-if="selectedTestType.id === 'acuite'">
                        <div class="text-center space-y-6">
                          <p class="text-gray-700 mb-4">{{ getCurrentTestStep().description }}</p>
                          <div class="bg-gray-50 border border-gray-300 rounded-lg p-8 inline-block">
                            <div class="font-mono font-bold text-gray-900"
                              :style="{ fontSize: getCurrentTestStep().size }">
                              {{ getCurrentTestStep().letter }}
                            </div>
                          </div>
                          <div class="space-y-3 max-w-md mx-auto">
                            <button v-for="option in getCurrentTestStep().options" :key="option"
                              @click="answerTestQuestion(option)" :class="[
                                'w-full px-6 py-3 border-2 rounded-lg font-medium transition-all',
                                testAnswers[currentTestStep] === option
                                  ? 'border-blue-600 bg-blue-100 text-blue-900'
                                  : 'bg-white border-gray-300 hover:border-blue-600 hover:bg-blue-50 text-gray-900'
                              ]">
                              {{ option }}
                            </button>
                          </div>
                        </div>
                      </div>

                      <!-- Test de Myopie -->
                      <div v-else-if="selectedTestType.id === 'myopie'">
                        <div class="text-center space-y-6">
                          <p class="text-gray-700 mb-4">{{ getCurrentTestStep().description }}</p>
                          <div v-if="getCurrentTestStep().letter"
                            class="bg-gray-50 border border-gray-300 rounded-lg p-8 inline-block">
                            <div class="font-mono font-bold text-gray-900"
                              :style="{ fontSize: getCurrentTestStep().size }">
                              {{ getCurrentTestStep().letter }}
                            </div>
                          </div>
                          <p v-else class="text-lg text-gray-800 mb-4">{{ getCurrentTestStep().question }}</p>
                          <div class="space-y-3 max-w-md mx-auto">
                            <button v-for="option in getCurrentTestStep().options" :key="option"
                              @click="answerTestQuestion(option)" :class="[
                                'w-full px-6 py-3 border-2 rounded-lg font-medium transition-all',
                                testAnswers[currentTestStep] === option
                                  ? 'border-blue-600 bg-blue-100 text-blue-900'
                                  : 'bg-white border-gray-300 hover:border-blue-600 hover:bg-blue-50 text-gray-900'
                              ]">
                              {{ option }}
                            </button>
                          </div>
                        </div>
                      </div>

                      <!-- Test d'Hyperm√©tropie -->
                      <div v-else-if="selectedTestType.id === 'hypermetropie'">
                        <div class="text-center space-y-6">
                          <p class="text-gray-700 mb-4">{{ getCurrentTestStep().description }}</p>
                          <div v-if="getCurrentTestStep().letter"
                            class="bg-gray-50 border border-gray-300 rounded-lg p-8 inline-block">
                            <div class="font-sans text-gray-900" :style="{ fontSize: getCurrentTestStep().size }">
                              {{ getCurrentTestStep().letter }}
                            </div>
                          </div>
                          <p v-else class="text-lg text-gray-800 mb-4">{{ getCurrentTestStep().question }}</p>
                          <div class="space-y-3 max-w-md mx-auto">
                            <button v-for="option in getCurrentTestStep().options" :key="option"
                              @click="answerTestQuestion(option)" :class="[
                                'w-full px-6 py-3 border-2 rounded-lg font-medium transition-all',
                                testAnswers[currentTestStep] === option
                                  ? 'border-blue-600 bg-blue-100 text-blue-900'
                                  : 'bg-white border-gray-300 hover:border-blue-600 hover:bg-blue-50 text-gray-900'
                              ]">
                              {{ option }}
                            </button>
                          </div>
                        </div>
                      </div>

                      <!-- Test de Daltonisme -->
                      <div v-else-if="selectedTestType.id === 'daltonisme'">
                        <div class="text-center space-y-6">
                          <p class="text-gray-700 mb-4">{{ getCurrentTestStep().description }}</p>
                          <div class="bg-gray-100 border border-gray-300 rounded-lg p-6 inline-block">
                            <div class="w-64 h-64 rounded-full flex items-center justify-center text-6xl font-bold"
                              :style="{ backgroundColor: getCurrentTestStep().color }">
                              {{ getCurrentTestStep().number || '?' }}
                            </div>
                          </div>
                          <div class="space-y-3 max-w-md mx-auto">
                            <button v-for="option in getCurrentTestStep().options" :key="option"
                              @click="answerTestQuestion(option)" :class="[
                                'w-full px-6 py-3 border-2 rounded-lg font-medium transition-all',
                                testAnswers[currentTestStep] === option
                                  ? 'border-blue-600 bg-blue-100 text-blue-900'
                                  : 'bg-white border-gray-300 hover:border-blue-600 hover:bg-blue-50 text-gray-900'
                              ]">
                              {{ option }}
                            </button>
                          </div>
                        </div>
                      </div>

                      <!-- Test d'Astigmatisme -->
                      <div v-else-if="selectedTestType.id === 'astigmatisme'">
                        <div class="text-center space-y-6">
                          <p class="text-gray-700 mb-4">{{ getCurrentTestStep().description }}</p>
                          <div class="bg-white border border-gray-300 rounded-lg p-4 sm:p-8 inline-block max-w-full">
                            <svg class="w-full max-w-[300px] h-auto" viewBox="0 0 300 300">
                              <g v-for="i in 12" :key="i" :transform="`rotate(${i * 30} 150 150)`">
                                <line x1="150" y1="20" x2="150" y2="100" stroke="black"
                                  :stroke-width="getCurrentTestStep().lineWidth || 3" />
                              </g>
                            </svg>
                          </div>
                          <div class="space-y-3 max-w-md mx-auto">
                            <button v-for="option in getCurrentTestStep().options" :key="option"
                              @click="answerTestQuestion(option)" :class="[
                                'w-full px-6 py-3 border-2 rounded-lg font-medium transition-all',
                                testAnswers[currentTestStep] === option
                                  ? 'border-blue-600 bg-blue-100 text-blue-900'
                                  : 'bg-white border-gray-300 hover:border-blue-600 hover:bg-blue-50 text-gray-900'
                              ]">
                              {{ option }}
                            </button>
                          </div>
                        </div>
                      </div>

                      <!-- Grille d'Amsler -->
                      <div v-else-if="selectedTestType.id === 'amsler'">
                        <div class="text-center space-y-6">
                          <p class="text-gray-700 mb-4">{{ getCurrentTestStep().description }}</p>
                          <div class="bg-white border border-gray-300 rounded-lg p-4 sm:p-6 inline-block max-w-full">
                            <svg class="w-full max-w-[400px] h-auto bg-white" viewBox="0 0 400 400">
                              <!-- Grille -->
                              <g v-for="i in 20" :key="'h' + i">
                                <line :x1="0" :y1="i * 20" :x2="400" :y2="i * 20" stroke="#000" stroke-width="1" />
                              </g>
                              <g v-for="i in 20" :key="'v' + i">
                                <line :x1="i * 20" :y1="0" :x2="i * 20" :y2="400" stroke="#000" stroke-width="1" />
                              </g>
                              <!-- Point central -->
                              <circle cx="200" cy="200" r="4" fill="black" />
                            </svg>
                          </div>
                          <div class="space-y-3 max-w-md mx-auto">
                            <button v-for="option in getCurrentTestStep().options" :key="option"
                              @click="answerTestQuestion(option)" :class="[
                                'w-full px-6 py-3 border-2 rounded-lg font-medium transition-all',
                                testAnswers[currentTestStep] === option
                                  ? 'border-blue-600 bg-blue-100 text-blue-900'
                                  : 'bg-white border-gray-300 hover:border-blue-600 hover:bg-blue-50 text-gray-900'
                              ]">
                              {{ option }}
                            </button>
                          </div>
                        </div>
                      </div>

                      <!-- Tests type questionnaire -->
                      <div v-else>
                        <div class="space-y-4">
                          <p class="text-gray-700 text-lg mb-6">{{ getCurrentTestStep().question }}</p>
                          <div class="space-y-3">
                            <button v-for="option in getCurrentTestStep().options" :key="option"
                              @click="answerTestQuestion(option)" :class="[
                                'w-full text-left px-6 py-4 border-2 rounded-lg transition-all',
                                testAnswers[currentTestStep] === option
                                  ? 'border-blue-600 bg-blue-100 text-blue-900'
                                  : 'bg-white border-gray-300 hover:border-blue-600 hover:bg-blue-50 text-gray-900'
                              ]">
                              {{ option }}
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </Transition>

                  <!-- Boutons de navigation -->
                  <div class="flex gap-3 mt-8 pt-6 border-t border-gray-200">
                    <button v-if="currentTestStep > 0" @click="previousTestStep"
                      aria-label="Retour √† l'√©tape pr√©c√©dente"
                      class="px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium rounded-lg transition-all">
                      ‚Üê Pr√©c√©dent
                    </button>
                    <div class="flex-1"></div>
                    <button v-if="currentTestStep < selectedTestType.stepCount - 1" @click="nextTestStep"
                      :disabled="!testAnswers[currentTestStep]" :aria-label="`Passer √† l'√©tape ${currentTestStep + 2}`"
                      class="px-6 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-medium rounded-lg transition-all">
                      Suivant ‚Üí
                    </button>
                    <button v-else @click="completeTest" :disabled="!testAnswers[currentTestStep]"
                      aria-label="Terminer le test et soumettre vos r√©ponses"
                      class="px-8 py-3 bg-green-600 hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-semibold rounded-lg transition-all">
                      ‚úì Terminer le test
                    </button>
                  </div>
                </div>
              </div>

              <!-- R√©sultat du Test -->
              <div v-else-if="selectedTestType && testCompleted" class="space-y-6">
                <div ref="testCompletionMessage" class="bg-green-50 border border-green-300 p-6 rounded-lg text-center">
                  <div class="text-6xl mb-4">‚úÖ</div>
                  <h3 class="text-2xl font-bold text-green-900 mb-2">Test termin√© avec succ√®s</h3>
                  <p class="text-green-800 mb-4">Vos r√©sultats ont √©t√© enregistr√©s et seront analys√©s par notre √©quipe
                    m√©dicale.</p>
                  <p class="text-sm text-green-700">Un rapport d√©taill√© vous sera envoy√© √† <strong>{{ testFormData.email
                      }}</strong> sous 24-48 heures.</p>
                </div>
                <button @click="resetTestSelection"
                  class="w-full px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-all">
                  Effectuer un autre test
                </button>
              </div>

              <!-- Contenu du Quiz -->
              <div v-else-if="selectedQuizType && !quizCompleted && !isCalculating" class="space-y-8">

                <!-- Indicateur de progression -->
                <div class="bg-white rounded-xl p-4 border-2 border-green-200">
                  <div class="flex items-center justify-between mb-2">
                    <span class="text-sm font-semibold text-gray-700">Progression</span>
                    <span class="text-sm font-bold text-green-600">{{answers.filter(a => a !== null).length}} / {{
                      questions.length }}</span>
                  </div>
                  <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                    <div
                      class="bg-gradient-to-r from-green-500 to-emerald-500 h-3 rounded-full transition-all duration-500"
                      :style="{ width: `${(answers.filter(a => a !== null).length / questions.length) * 100}%` }"></div>
                  </div>
                  <p class="text-xs text-gray-500 mt-2 text-center">Page {{ currentQuestionPage + 1 }} sur {{ totalPages
                  }}</p>
                </div>

                <!-- Questions -->
                <Transition name="test-step" mode="out-in">
                  <div :key="currentQuestionPage">
                    <div v-for="q in displayedQuestions" :key="q.globalIndex"
                      class="relative p-6 bg-gradient-to-br from-green-50 to-emerald-50 rounded-2xl border border-green-100 shadow-sm hover:shadow-md transition-all mb-6">

                      <!-- Num√©ro de question -->
                      <div
                        class="absolute -top-4 -left-4 w-12 h-12 bg-gradient-to-br from-green-600 to-emerald-600 rounded-full flex items-center justify-center text-white font-bold text-xl shadow-lg">
                        {{ q.globalIndex + 1 }}
                      </div>

                      <p class="text-xl font-bold text-gray-900 mb-5 pl-8">
                        {{ q.text }}
                      </p>

                      <div class="space-y-3">
                        <button v-for="(option, oIndex) in q.options" :key="oIndex"
                          @click="answers[q.globalIndex] = option.value" :class="[
                            'w-full text-left p-4 border-2 rounded-xl transition-all',
                            answers[q.globalIndex] === option.value
                              ? 'border-green-600 bg-green-50'
                              : 'border-gray-200 bg-white hover:border-green-400 hover:shadow-md'
                          ]">
                          <div class="flex items-center gap-3">
                            <!-- Cercle de s√©lection -->
                            <div :class="[
                              'w-6 h-6 border-2 rounded-full transition-all flex items-center justify-center',
                              answers[q.globalIndex] === option.value
                                ? 'border-green-600 bg-green-600'
                                : 'border-gray-300'
                            ]">
                              <svg v-if="answers[q.globalIndex] === option.value" class="w-4 h-4 text-white"
                                fill="currentColor" viewBox="0 0 20 20">
                                <path
                                  d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" />
                              </svg>
                            </div>
                            <span class="text-gray-700 font-medium">{{ option.text }}</span>
                          </div>
                        </button>
                      </div>
                    </div>
                  </div>
                </Transition>

                <!-- Navigation et Soumission -->
                <div class="flex gap-3 pt-6">
                  <!-- Bouton Pr√©c√©dent -->
                  <button v-if="currentQuestionPage > 0" @click="previousPage"
                    class="px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold rounded-xl transition-all flex items-center gap-2">
                    ‚Üê Pr√©c√©dent
                  </button>

                  <div class="flex-1"></div>

                  <!-- Bouton Suivant -->
                  <button v-if="currentQuestionPage < totalPages - 1" @click="nextPage" :disabled="!isCurrentPageValid"
                    class="px-6 py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-semibold rounded-xl transition-all disabled:from-gray-300 disabled:to-gray-400 disabled:cursor-not-allowed flex items-center gap-2">
                    Suivant ‚Üí
                  </button>

                  <!-- Bouton Soumettre (derni√®re page) -->
                  <button v-else @click="calculateResults" :disabled="!isQuizValid"
                    class="flex-1 py-4 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-bold text-lg rounded-xl transition-all duration-300 disabled:from-gray-300 disabled:to-gray-400 disabled:cursor-not-allowed shadow-lg hover:shadow-xl transform hover:scale-[1.02] disabled:transform-none">
                    <span v-if="isQuizValid">‚ö° Obtenir mes R√©sultats</span>
                    <span v-else>‚ö†Ô∏è Compl√©tez toutes les questions</span>
                  </button>
                </div>
              </div>

              <!-- √âcran de Chargement Professionnel -->
              <div v-else-if="isCalculating" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50">
                <div class="bg-white rounded-2xl p-10 text-center max-w-md mx-4 shadow-2xl">
                  <!-- Spinner -->
                  <div
                    class="animate-spin w-20 h-20 border-4 border-green-600 border-t-transparent rounded-full mx-auto mb-6">
                  </div>

                  <!-- Ic√¥ne du Quiz -->
                  <div class="text-6xl mb-4">{{ selectedQuizType.icon }}</div>

                  <!-- Texte Principal -->
                  <h3 class="text-2xl font-bold text-gray-900 mb-2">Analyse en cours...</h3>
                  <p class="text-gray-600 mb-6">
                    Nous analysons vos {{ questions.length }} r√©ponses
                  </p>

                  <!-- Barre de progression -->
                  <div class="w-full bg-gray-200 rounded-full h-2 overflow-hidden mb-4">
                    <div class="bg-gradient-to-r from-green-600 to-emerald-600 h-full rounded-full"
                      style="width: 100%; animation: progressBar 8s ease-in-out"></div>
                  </div>

                  <!-- √âtapes -->
                  <div class="space-y-2 text-left">
                    <div class="flex items-center gap-2 text-gray-700 text-sm">
                      <div class="relative flex items-center justify-center">
                        <div class="w-2 h-2 bg-green-600 rounded-full"></div>
                        <div class="absolute w-2 h-2 bg-green-600 rounded-full animate-ping"></div>
                      </div>
                      <span>Traitement de vos r√©ponses...</span>
                    </div>
                    <div class="flex items-center gap-2 text-gray-700 text-sm">
                      <div class="relative flex items-center justify-center">
                        <div class="w-2 h-2 bg-emerald-600 rounded-full"></div>
                        <div class="absolute w-2 h-2 bg-emerald-600 rounded-full animate-ping"
                          style="animation-delay: 0.3s"></div>
                      </div>
                      <span>Analyse de votre profil visuel...</span>
                    </div>
                    <div class="flex items-center gap-2 text-gray-700 text-sm">
                      <div class="relative flex items-center justify-center">
                        <div class="w-2 h-2 bg-green-700 rounded-full"></div>
                        <div class="absolute w-2 h-2 bg-green-700 rounded-full animate-ping"
                          style="animation-delay: 0.6s"></div>
                      </div>
                      <span>G√©n√©ration des recommandations...</span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- R√©sultats du Quiz - Version Formelle et Professionnelle -->
              <div v-else-if="quizCompleted && !isCalculating" class="py-8">

                <!-- Message de confirmation d'envoi -->
                <div v-if="quizResultSent"
                  class="bg-green-50 border-2 border-green-500 rounded-xl p-6 mb-6 animate-fade-in">
                  <div class="flex items-start gap-4">
                    <div class="text-4xl">‚úÖ</div>
                    <div class="flex-1">
                      <h4 class="text-lg font-bold text-green-900 mb-2">R√©sultats envoy√©s avec succ√®s !</h4>
                      <p class="text-green-800 text-sm">Un rapport d√©taill√© de votre √©valuation a √©t√© envoy√© √† votre
                        adresse email. Vous le recevrez dans quelques minutes.</p>
                    </div>
                  </div>
                </div>

                <!-- En-t√™te Rapport Formel -->
                <div class="bg-white rounded-lg border-2 border-gray-300 p-8 mb-6 shadow-sm">
                  <div class="border-b border-gray-200 pb-6 mb-6">
                    <div class="flex items-center justify-between mb-4">
                      <div>
                        <p class="text-sm text-gray-500 uppercase tracking-wide mb-1">Rapport d'√âvaluation</p>
                        <h3 class="text-3xl font-bold text-gray-900">{{ selectedQuizType.title }}</h3>
                      </div>
                      <div class="text-5xl opacity-80">{{ selectedQuizType.icon }}</div>
                    </div>
                    <div class="flex items-center gap-6 text-sm text-gray-600">
                      <div class="flex items-center gap-2">
                        <span class="font-medium">Date :</span>
                        <span>{{ new Date().toLocaleDateString('fr-FR', {
                          day: '2-digit', month: 'long', year: 'numeric'
                        }) }}</span>
                      </div>
                      <div class="flex items-center gap-2">
                        <span class="font-medium">Questions trait√©es :</span>
                        <span>{{ questions.length }}</span>
                      </div>
                      <div class="flex items-center gap-2">
                        <span class="font-medium">Taux de compl√©tion :</span>
                        <span class="text-green-700 font-semibold">100%</span>
                      </div>
                    </div>
                  </div>

                  <div>
                    <h4 class="text-sm font-semibold text-gray-700 uppercase tracking-wide mb-2">Contexte de
                      l'√©valuation</h4>
                    <p class="text-gray-700 leading-relaxed">{{ selectedQuizType.description }}</p>
                  </div>
                </div>

                <!-- Analyse et Recommandations -->
                <div class="bg-white rounded-lg border-2 border-gray-300 p-8 mb-6 shadow-sm">
                  <h4 class="text-xl font-bold text-gray-900 mb-4 pb-3 border-b border-gray-200">
                    Analyse de votre profil et recommandations
                  </h4>
                  <div class="prose prose-gray max-w-none">
                    <p class="text-gray-700 leading-relaxed mb-4">
                      Suite √† l'analyse approfondie de vos r√©ponses, notre syst√®me a √©tabli le profil suivant :
                    </p>
                    <div class="bg-gray-50 border-l-4 border-gray-400 p-6 my-4">
                      <p class="text-gray-800 leading-relaxed whitespace-pre-line">{{ resultMessage }}</p>
                    </div>
                  </div>
                </div>

                <!-- Recommandations Professionnelles -->
                <div class="bg-white rounded-lg border-2 border-gray-300 p-8 mb-6 shadow-sm">
                  <h4 class="text-xl font-bold text-gray-900 mb-4 pb-3 border-b border-gray-200">
                    Recommandations professionnelles
                  </h4>
                  <div class="space-y-4">
                    <div class="flex items-start gap-4 p-4 bg-gray-50 rounded-lg">
                      <div
                        class="flex-shrink-0 w-10 h-10 bg-gray-700 text-white rounded-full flex items-center justify-center font-bold">
                        1
                      </div>
                      <div>
                        <h5 class="font-bold text-gray-900 mb-2">Consultation ophtalmologique</h5>
                        <p class="text-sm text-gray-600 leading-relaxed">
                          Nous vous recommandons de planifier un examen complet avec l'un de nos opticiens dipl√¥m√©s
                          d'√âtat.
                          Cette consultation permettra de valider ces recommandations et d'√©tablir une prescription
                          pr√©cise adapt√©e √† votre vue.
                        </p>
                      </div>
                    </div>

                    <div class="flex items-start gap-4 p-4 bg-gray-50 rounded-lg">
                      <div
                        class="flex-shrink-0 w-10 h-10 bg-gray-700 text-white rounded-full flex items-center justify-center font-bold">
                        2
                      </div>
                      <div>
                        <h5 class="font-bold text-gray-900 mb-2">Examen approfondi avec √©quipement m√©dical</h5>
                        <p class="text-sm text-gray-600 leading-relaxed">
                          Notre centre dispose d'√©quipements de diagnostic de derni√®re g√©n√©ration permettant une analyse
                          d√©taill√©e de votre sant√© oculaire (r√©fractom√®tre, tonom√®tre, fond d'≈ìil, etc.).
                        </p>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Suite √† donner -->
                <div class="bg-gray-800 text-white rounded-lg p-8 mb-6 shadow-sm">
                  <h4 class="text-xl font-bold mb-4">Suite √† donner √† cette √©valuation</h4>
                  <p class="text-gray-300 mb-6 leading-relaxed">
                    Pour b√©n√©ficier d'un accompagnement personnalis√© et d'une prise en charge optimale de votre sant√©
                    visuelle,
                    nous vous invitons √† prendre contact avec notre √©quipe.
                  </p>
                  <div class="grid sm:grid-cols-2 gap-4">
                    <RouterLink to="/rendez-vous"
                      class="inline-flex items-center justify-center gap-3 bg-white hover:bg-gray-100 text-gray-900 font-semibold py-4 px-6 rounded-lg transition-all duration-200">
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                      </svg>
                      Prendre rendez-vous
                    </RouterLink>
                    <RouterLink to="/contact"
                      class="inline-flex items-center justify-center gap-3 bg-transparent hover:bg-gray-700 text-white font-semibold py-4 px-6 rounded-lg border-2 border-white/30 transition-all duration-200">
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                      </svg>
                      Nous contacter
                    </RouterLink>
                  </div>
                </div>

                <!-- Actions -->
                <div class="flex flex-col sm:flex-row gap-4">
                  <RouterLink to="/catalogue"
                    class="inline-flex items-center justify-center gap-2 bg-gray-700 hover:bg-gray-800 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                    </svg>
                    Consulter notre catalogue
                  </RouterLink>
                  <button @click="resetQuiz"
                    class="inline-flex items-center justify-center gap-2 bg-white hover:bg-gray-50 text-gray-700 font-semibold py-3 px-6 rounded-lg border-2 border-gray-300 hover:border-gray-400 transition-all duration-200">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                    Nouvelle √©valuation
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Colonne Droite : FAQ Th√©matique -->
        <div class="lg:col-span-1">
          <div class="bg-white rounded-2xl shadow-lg overflow-hidden border border-gray-200 sticky top-24">

            <!-- En-t√™te FAQ -->
            <div class="bg-gray-800 px-5 py-4 border-b border-gray-300">
              <h2 class="text-lg font-semibold text-white flex items-center gap-2">
                <span class="text-xl">üí°</span>
                Foire Aux Questions
              </h2>
            </div>

            <!-- Items FAQ -->
            <div class="p-4 space-y-2 max-h-[500px] overflow-y-auto">
              <div v-for="(item, index) in faqItems" :key="index"
                class="border border-gray-300 rounded-lg overflow-hidden hover:border-gray-400 transition-all">
                <button @click="toggleFaq(index)"
                  class="flex justify-between items-center w-full text-left px-4 py-3 bg-white hover:bg-gray-50 transition-all">
                  <span class="font-medium text-gray-900 text-sm pr-3">{{ item.question }}</span>
                  <span
                    class="flex-shrink-0 w-6 h-6 bg-gray-200 rounded-full flex items-center justify-center text-gray-700 text-sm font-bold transition-transform"
                    :class="{ 'rotate-45': item.open }">
                    +
                  </span>
                </button>
                <div v-if="item.open" class="bg-gray-50 px-4 py-3 border-t border-gray-200 animate-fade-in">
                  <p class="text-gray-700 text-sm leading-relaxed">{{ item.answer }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Section Conseil Personnalis√© - Pleine largeur -->
    <div class="w-full px-4 sm:px-6 lg:px-8 py-12">
      <div id="conseils-section" class="scroll-mt-20">
        <div class="bg-white rounded-3xl shadow-2xl overflow-hidden border border-gray-100">

          <!-- En-t√™te Conseil -->
          <div class="relative bg-gradient-to-br from-emerald-900 via-teal-800 to-green-900 p-8 overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent animate-shimmer">
            </div>
            <div class="absolute inset-0 opacity-10"
              style="background-image: radial-gradient(circle, white 1px, transparent 1px); background-size: 20px 20px;">
            </div>

            <div class="relative z-10">
              <h2 class="text-3xl font-bold text-white flex items-center gap-3 drop-shadow-lg">
                <span class="text-4xl">üí¨</span>
                Besoin d'un Conseil Personnalis√© ?
              </h2>
              <p class="text-green-100 mt-2">D√©crivez votre probl√®me ou besoin, nos experts vous r√©pondront par email
              </p>
            </div>
          </div>

          <!-- Formulaire de conseil -->
          <form @submit.prevent="sendAdviceRequest" class="p-8 space-y-6">

            <!-- Nom & Email -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label class="block text-sm font-bold text-gray-700 mb-2">
                  Votre Nom <span class="text-red-500">*</span>
                </label>
                <input v-model="adviceForm.name" type="text" required placeholder="Jean Dupont"
                  class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-green-600 focus:ring-2 focus:ring-green-200 transition-all outline-none" />
              </div>
              <div>
                <label class="block text-sm font-bold text-gray-700 mb-2">
                  Votre Email <span class="text-red-500">*</span>
                </label>
                <input v-model="adviceForm.email" type="email" required placeholder="jean.dupont@email.com"
                  class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-green-600 focus:ring-2 focus:ring-green-200 transition-all outline-none" />
              </div>
            </div>

            <!-- T√©l√©phone -->
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-2">
                T√©l√©phone <span class="text-gray-400 text-xs">(optionnel)</span>
              </label>
              <input v-model="adviceForm.phone" type="tel" placeholder="+225 XX XX XX XX XX"
                class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-green-600 focus:ring-2 focus:ring-green-200 transition-all outline-none" />
            </div>

            <!-- Sujet -->
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-2">
                Sujet de votre demande <span class="text-red-500">*</span>
              </label>
              <select v-model="adviceForm.subject" required
                class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-green-600 focus:ring-2 focus:ring-green-200 transition-all outline-none bg-white">
                <option value="">-- S√©lectionnez un sujet --</option>
                <option value="vision">Probl√®me de vision</option>
                <option value="monture">Conseil sur les montures</option>
                <option value="verre">Conseil sur les verres</option>
                <option value="adaptation">Difficult√© d'adaptation</option>
                <option value="autre">Autre demande</option>
              </select>
            </div>

            <!-- Message -->
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-2">
                D√©crivez votre probl√®me ou besoin <span class="text-red-500">*</span>
              </label>
              <textarea v-model="adviceForm.message" required rows="6"
                placeholder="Expliquez en d√©tail votre situation, vos sympt√¥mes ou vos besoins..."
                class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-green-600 focus:ring-2 focus:ring-green-200 transition-all outline-none resize-none"></textarea>
              <p class="text-xs text-gray-500 mt-2">{{ adviceForm.message.length }} / 500 caract√®res minimum</p>
            </div>

            <!-- Message de succ√®s/erreur -->
            <div v-if="adviceStatus.show"
              :class="adviceStatus.success ? 'bg-green-50 border-green-200 text-green-800' : 'bg-red-50 border-red-200 text-red-800'"
              class="p-4 rounded-xl border-2 flex items-start gap-3">
              <span class="text-2xl">{{ adviceStatus.success ? '‚úÖ' : '‚ùå' }}</span>
              <p class="flex-1">{{ adviceStatus.message }}</p>
            </div>

            <!-- Bouton d'envoi -->
            <div class="pt-4">
              <button type="submit" :disabled="adviceSending || !isAdviceFormValid"
                class="w-full py-4 bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-700 hover:to-teal-700 text-white font-bold text-lg rounded-xl transition-all duration-300 disabled:from-gray-300 disabled:to-gray-400 disabled:cursor-not-allowed shadow-lg hover:shadow-xl transform hover:scale-[1.02] disabled:transform-none">
                <span v-if="adviceSending">‚è≥ Envoi en cours...</span>
                <span v-else-if="isAdviceFormValid">üìß Envoyer ma demande</span>
                <span v-else>‚ö†Ô∏è Veuillez remplir tous les champs obligatoires</span>
              </button>
            </div>

          </form>
        </div>
      </div>
    </div>

    <!-- Modal de S√©lection de Quiz -->
    <Teleport to="body">
      <Transition name="modal">
        <div v-if="showQuizModal" @click="closeQuizModal"
          class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div @click.stop class="bg-white rounded-3xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden">

            <!-- En-t√™te du modal -->
            <div class="relative bg-gradient-to-br from-green-900 via-green-800 to-emerald-900 p-6 overflow-hidden">
              <div
                class="absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent animate-shimmer">
              </div>

              <div class="relative z-10 flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <span class="text-4xl">üìã</span>
                  <h3 class="text-2xl font-bold text-white">Choisissez un Quiz</h3>
                </div>
                <button @click="closeQuizModal"
                  class="w-10 h-10 bg-white/20 hover:bg-white/30 rounded-full flex items-center justify-center text-white transition-all">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                </button>
              </div>
            </div>

            <!-- Liste des quiz -->
            <div class="p-6 overflow-y-auto max-h-[calc(90vh-120px)]">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div v-for="quiz in quizTypes" :key="quiz.id" @click="selectQuiz(quiz)"
                  class="group p-6 bg-gradient-to-br from-green-50 to-emerald-50 rounded-2xl border-2 border-green-200 hover:border-green-600 cursor-pointer transition-all hover:shadow-lg transform hover:scale-105">
                  <div class="text-4xl mb-3">{{ quiz.icon }}</div>
                  <h4 class="text-xl font-bold text-gray-900 mb-2 group-hover:text-green-600 transition-colors">{{
                    quiz.title }}</h4>
                  <p class="text-sm text-gray-600 mb-3">{{ quiz.description }}</p>
                  <div class="flex items-center gap-2 text-sm text-green-600 font-semibold">
                    <span>{{ quiz.questionCount }} questions</span>
                    <span>‚Ä¢</span>
                    <span>{{ quiz.duration }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </Transition>
    </Teleport>

    <!-- Modal de S√©lection de Test -->
    <Teleport to="body">
      <Transition name="modal">
        <div v-if="showTestModal" @click="closeTestModal"
          class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div @click.stop class="bg-white rounded-3xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden">

            <!-- En-t√™te du modal -->
            <div class="relative bg-gradient-to-br from-blue-900 via-indigo-800 to-purple-900 p-6 overflow-hidden">
              <div
                class="absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent animate-shimmer">
              </div>

              <div class="relative z-10 flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <span class="text-4xl">üî¨</span>
                  <h3 class="text-2xl font-bold text-white">Choisissez un Test</h3>
                </div>
                <button @click="closeTestModal"
                  class="w-10 h-10 bg-white/20 hover:bg-white/30 rounded-full flex items-center justify-center text-white transition-all">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                </button>
              </div>
            </div>

            <!-- Liste des tests -->
            <div class="p-6 overflow-y-auto max-h-[calc(90vh-120px)]">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div v-for="test in testTypes" :key="test.id" @click="selectTest(test)"
                  class="group p-6 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl border-2 border-blue-200 hover:border-blue-600 cursor-pointer transition-all hover:shadow-lg transform hover:scale-105">
                  <div class="text-4xl mb-3">{{ test.icon }}</div>
                  <h4 class="text-xl font-bold text-gray-900 mb-2 group-hover:text-blue-600 transition-colors">{{
                    test.title }}</h4>
                  <p class="text-sm text-gray-600 mb-3">{{ test.description }}</p>
                  <div class="flex items-center gap-2 text-sm text-blue-600 font-semibold">
                    <span>{{ test.stepCount }} √©tapes</span>
                    <span>‚Ä¢</span>
                    <span>{{ test.duration }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </Transition>
    </Teleport>
  </div>
</template>

<script setup>
import { ref, computed, onMounted, watch, Transition } from 'vue';
import { RouterLink } from 'vue-router';

// --- Gestion des Modals ---
const showQuizModal = ref(false);
const showTestModal = ref(false);
const selectedQuizType = ref(null);
const selectedTestType = ref(null);
const testFormVisible = ref(false);
const testSubmitted = ref(false);
const testFormSubmitted = ref(false);
const testCompleted = ref(false);
const currentTestStep = ref(0);
const testAnswers = ref([]);
const testCompletionMessage = ref(null);
const testFormData = ref({
  name: '',
  email: '',
  phone: ''
});

// Validation et messages
const emailError = ref('');
const phoneError = ref('');
const quizResultSent = ref(false);

const openQuizModal = () => {
  showQuizModal.value = true;
};

const closeQuizModal = () => {
  showQuizModal.value = false;
};

const openTestModal = () => {
  showTestModal.value = true;
};

const closeTestModal = () => {
  showTestModal.value = false;
};

// --- Types de Quiz disponibles ---
const quizTypes = ref([
  {
    id: 'depistage-vision',
    title: 'D√©pistage de Probl√®mes de Vision',
    icon: 'üëÅÔ∏è',
    description: '√âvaluez les sympt√¥mes et signes pr√©coces de troubles visuels',
    questionCount: 12,
    duration: '6 min',
    questions: [
      {
        text: "Avez-vous des difficult√©s √† voir les objets √©loign√©s clairement ?",
        options: [
          { text: "Jamais", value: 'a' },
          { text: "Parfois", value: 'b' },
          { text: "Souvent", value: 'c' }
        ],
      },
      {
        text: "Ressentez-vous des maux de t√™te apr√®s une lecture prolong√©e ?",
        options: [
          { text: "Non", value: 'a' },
          { text: "Occasionnellement", value: 'b' },
          { text: "R√©guli√®rement", value: 'c' }
        ],
      },
      {
        text: "Avez-vous besoin de plisser les yeux pour lire de loin ?",
        options: [
          { text: "Non", value: 'a' },
          { text: "Parfois", value: 'b' },
          { text: "Tr√®s souvent", value: 'c' }
        ],
      },
      {
        text: "Avez-vous du mal √† lire de pr√®s (livres, t√©l√©phone) ?",
        options: [
          { text: "Non, aucun probl√®me", value: 'a' },
          { text: "Oui, je dois √©loigner le texte", value: 'b' },
          { text: "Oui, avec fatigue oculaire", value: 'c' }
        ],
      },
      {
        text: "Voyez-vous des halos autour des lumi√®res la nuit ?",
        options: [
          { text: "Jamais", value: 'a' },
          { text: "Rarement", value: 'b' },
          { text: "Fr√©quemment", value: 'c' }
        ],
      },
      {
        text: "Vos yeux sont-ils souvent rouges ou irrit√©s ?",
        options: [
          { text: "Non", value: 'a' },
          { text: "Parfois", value: 'b' },
          { text: "Tr√®s souvent", value: 'c' }
        ],
      },
      {
        text: "Avez-vous une vision double occasionnelle ?",
        options: [
          { text: "Jamais", value: 'a' },
          { text: "Rarement", value: 'b' },
          { text: "R√©guli√®rement", value: 'c' }
        ],
      },
      {
        text: "Ressentez-vous une sensibilit√© excessive √† la lumi√®re ?",
        options: [
          { text: "Non", value: 'a' },
          { text: "L√©g√®rement", value: 'b' },
          { text: "Oui, tr√®s g√™nant", value: 'c' }
        ],
      },
      {
        text: "Avez-vous des difficult√©s √† conduire de nuit ?",
        options: [
          { text: "Non, aucune difficult√©", value: 'a' },
          { text: "Oui, avec √©blouissement", value: 'b' },
          { text: "Oui, vision tr√®s limit√©e", value: 'c' }
        ],
      },
      {
        text: "Constatez-vous une baisse progressive de votre vision ?",
        options: [
          { text: "Non", value: 'a' },
          { text: "L√©g√®re depuis quelques mois", value: 'b' },
          { text: "Importante et r√©cente", value: 'c' }
        ],
      },
      {
        text: "Avez-vous des ant√©c√©dents familiaux de probl√®mes visuels ?",
        options: [
          { text: "Non", value: 'a' },
          { text: "Oui, l√©gers", value: 'b' },
          { text: "Oui, importants (glaucome, DMLA, etc.)", value: 'c' }
        ],
      },
      {
        text: "√Ä quand remonte votre dernier examen de vue ?",
        options: [
          { text: "Moins de 6 mois", value: 'a' },
          { text: "1 √† 2 ans", value: 'b' },
          { text: "Plus de 3 ans ou jamais", value: 'c' }
        ],
      }
    ]
  },
  {
    id: 'selection-lunettes',
    title: 'S√©lection de Lunettes',
    icon: 'üëì',
    description: 'Trouvez le type de lunettes adapt√© √† votre morphologie et besoins',
    questionCount: 10,
    duration: '5 min',
    questions: [
      {
        text: "Quelle est la forme de votre visage ?",
        options: [
          { text: "Ovale", value: 'a' },
          { text: "Carr√©", value: 'b' },
          { text: "Rond", value: 'c' }
        ],
      },
      {
        text: "Quelle est votre principale activit√© n√©cessitant des lunettes ?",
        options: [
          { text: "Lecture", value: 'a' },
          { text: "Ordinateur", value: 'b' },
          { text: "Sport", value: 'c' }
        ],
      },
      {
        text: "Pr√©f√©rez-vous des montures l√©g√®res ou robustes ?",
        options: [
          { text: "L√©g√®res", value: 'a' },
          { text: "Robustes", value: 'b' },
          { text: "√âquilibr√©es", value: 'c' }
        ],
      },
      {
        text: "Quel est votre style vestimentaire habituel ?",
        options: [
          { text: "Classique/Professionnel", value: 'a' },
          { text: "D√©contract√©/Sportif", value: 'b' },
          { text: "Tendance/Mode", value: 'c' }
        ],
      },
      {
        text: "Quelle est votre couleur de cheveux ?",
        options: [
          { text: "Blond/Clair", value: 'a' },
          { text: "Ch√¢tain/Roux", value: 'b' },
          { text: "Brun/Noir", value: 'c' }
        ],
      },
      {
        text: "Quelle couleur de monture pr√©f√©rez-vous ?",
        options: [
          { text: "Noir/Gris/Argent", value: 'a' },
          { text: "Brun/√âcaille/Dor√©", value: 'b' },
          { text: "Couleurs vives/Originales", value: 'c' }
        ],
      },
      {
        text: "Quelle taille de monture vous convient ?",
        options: [
          { text: "Petite (discr\u00e8te)", value: 'a' },
          { text: "Moyenne (standard)", value: 'b' },
          { text: "Grande (statement)", value: 'c' }
        ],
      },
      {
        text: "Porterez-vous vos lunettes toute la journ√©e ?",
        options: [
          { text: "Oui, en permanence", value: 'a' },
          { text: "Seulement pour certaines activit√©s", value: 'b' },
          { text: "Rarement", value: 'c' }
        ],
      },
      {
        text: "Quel type de mat√©riau pr√©f√©rez-vous ?",
        options: [
          { text: "M√©tal (Titane, Acier)", value: 'a' },
          { text: "Plastique (Ac√©tate)", value: 'b' },
          { text: "Mixte", value: 'c' }
        ],
      },
      {
        text: "Quel est votre budget approximatif ?",
        options: [
          { text: "Moins de 50 000 FCFA", value: 'a' },
          { text: "50 000 - 150 000 FCFA", value: 'b' },
          { text: "Plus de 150 000 FCFA", value: 'c' }
        ],
      }
    ]
  },
  {
    id: 'detection-maladies',
    title: 'D√©tection de Maladies Oculaires',
    icon: 'üî¨',
    description: 'Identifiez les signes pr√©curseurs de pathologies oculaires courantes',
    questionCount: 15,
    duration: '8 min',
    questions: [
      {
        text: "Voyez-vous des taches flottantes ou des mouches volantes ?",
        options: [
          { text: "Non", value: 'a' },
          { text: "Quelques-unes", value: 'b' },
          { text: "Beaucoup, surtout r√©cemment", value: 'c' }
        ],
      },
      {
        text: "Avez-vous une perte progressive de vision p√©riph√©rique ?",
        options: [
          { text: "Non", value: 'a' },
          { text: "L√©g√®re", value: 'b' },
          { text: "Importante", value: 'c' }
        ],
      },
      {
        text: "Ressentez-vous des douleurs oculaires avec vision floue ?",
        options: [
          { text: "Jamais", value: 'a' },
          { text: "Rarement", value: 'b' },
          { text: "Fr√©quemment", value: 'c' }
        ],
      },
      {
        text: "Voyez-vous des √©clairs lumineux dans votre vision ?",
        options: [
          { text: "Jamais", value: 'a' },
          { text: "Occasionnellement", value: 'b' },
          { text: "Fr√©quemment", value: 'c' }
        ],
      },
      {
        text: "Avez-vous remarqu√© un voile ou rideau dans votre champ visuel ?",
        options: [
          { text: "Non", value: 'a' },
          { text: "Parfois", value: 'b' },
          { text: "Oui, persistant", value: 'c' }
        ],
      },
      {
        text: "Les lignes droites vous apparaissent-elles d√©form√©es ou ondul√©es ?",
        options: [
          { text: "Non, toujours droites", value: 'a' },
          { text: "L√©g√®rement", value: 'b' },
          { text: "Oui, nettement d√©form√©es", value: 'c' }
        ],
      },
      {
        text: "Avez-vous une vision centrale floue ou obscurcie ?",
        options: [
          { text: "Non", value: 'a' },
          { text: "L√©g√®re", value: 'b' },
          { text: "Importante", value: 'c' }
        ],
      },
      {
        text: "Ressentez-vous une pression ou douleur dans les yeux ?",
        options: [
          { text: "Jamais", value: 'a' },
          { text: "Parfois", value: 'b' },
          { text: "Souvent", value: 'c' }
        ],
      },
      {
        text: "Avez-vous des rougeurs oculaires fr√©quentes ?",
        options: [
          { text: "Rarement", value: 'a' },
          { text: "Occasionnellement", value: 'b' },
          { text: "Tr√®s fr√©quemment", value: 'c' }
        ],
      },
      {
        text: "Voyez-vous des halos color√©s autour des lumi√®res ?",
        options: [
          { text: "Non", value: 'a' },
          { text: "Parfois", value: 'b' },
          { text: "R√©guli√®rement", value: 'c' }
        ],
      },
      {
        text: "Avez-vous des difficult√©s √† distinguer les couleurs ?",
        options: [
          { text: "Non", value: 'a' },
          { text: "L√©g√®res", value: 'b' },
          { text: "Importantes", value: 'c' }
        ],
      },
      {
        text: "Vos yeux larmoient-ils excessivement ?",
        options: [
          { text: "Non", value: 'a' },
          { text: "Parfois", value: 'b' },
          { text: "Constamment", value: 'c' }
        ],
      },
      {
        text: "Avez-vous des ant√©c√©dents de diab√®te ou d'hypertension ?",
        options: [
          { text: "Non", value: 'a' },
          { text: "Diab√®te ou hypertension contr√¥l√©", value: 'b' },
          { text: "Oui, mal contr√¥l√©", value: 'c' }
        ],
      },
      {
        text: "Avez-vous plus de 60 ans ?",
        options: [
          { text: "Non, moins de 40 ans", value: 'a' },
          { text: "Entre 40 et 60 ans", value: 'b' },
          { text: "Oui, plus de 60 ans", value: 'c' }
        ],
      },
      {
        text: "Avez-vous subi un traumatisme oculaire r√©cent ?",
        options: [
          { text: "Non", value: 'a' },
          { text: "Oui, l√©ger", value: 'b' },
          { text: "Oui, important", value: 'c' }
        ],
      }
    ]
  },
  {
    id: 'sante-oculaire',
    title: 'V√©rification de Sant√© Oculaire',
    icon: 'üíö',
    description: '√âvaluez votre sant√© oculaire globale et habitudes de soin',
    questionCount: 12,
    duration: '6 min',
    questions: [
      {
        text: "√Ä quelle fr√©quence consultez-vous un ophtalmologiste ?",
        options: [
          { text: "Tous les 6 mois", value: 'a' },
          { text: "Une fois par an", value: 'b' },
          { text: "Rarement ou jamais", value: 'c' }
        ],
      },
      {
        text: "Portez-vous des lunettes de soleil avec protection UV ?",
        options: [
          { text: "Toujours en ext√©rieur", value: 'a' },
          { text: "Parfois", value: 'b' },
          { text: "Rarement", value: 'c' }
        ],
      },
      {
        text: "Avez-vous des ant√©c√©dents familiaux de maladies oculaires ?",
        options: [
          { text: "Non", value: 'a' },
          { text: "Oui, mais l√©gers", value: 'b' },
          { text: "Oui, importants", value: 'c' }
        ],
      },
      {
        text: "Fumez-vous ou √™tes-vous expos√© √† la fum√©e ?",
        options: [
          { text: "Non", value: 'a' },
          { text: "Occasionnellement", value: 'b' },
          { text: "R√©guli√®rement", value: 'c' }
        ],
      },
      {
        text: "Pratiquez-vous une activit√© physique r√©guli√®re ?",
        options: [
          { text: "Oui, r√©guli√®rement", value: 'a' },
          { text: "Occasionnellement", value: 'b' },
          { text: "Rarement ou jamais", value: 'c' }
        ],
      },
      {
        text: "Consommez-vous des aliments riches en vitamines A, C et E ?",
        options: [
          { text: "Oui, quotidiennement", value: 'a' },
          { text: "Parfois", value: 'b' },
          { text: "Rarement", value: 'c' }
        ],
      },
      {
        text: "Dormez-vous suffisamment (7-8h par nuit) ?",
        options: [
          { text: "Oui, r√©guli√®rement", value: 'a' },
          { text: "Parfois", value: 'b' },
          { text: "Rarement", value: 'c' }
        ],
      },
      {
        text: "Passez-vous plus de 6 heures par jour devant un √©cran ?",
        options: [
          { text: "Non, moins de 4h", value: 'a' },
          { text: "4-6 heures", value: 'b' },
          { text: "Oui, plus de 6h", value: 'c' }
        ],
      },
      {
        text: "Utilisez-vous un √©clairage adapt√© pour lire ou travailler ?",
        options: [
          { text: "Oui, toujours", value: 'a' },
          { text: "Parfois", value: 'b' },
          { text: "Non", value: 'c' }
        ],
      },
      {
        text: "Buvez-vous suffisamment d'eau (1.5-2L par jour) ?",
        options: [
          { text: "Oui", value: 'a' },
          { text: "Parfois", value: 'b' },
          { text: "Non", value: 'c' }
        ],
      },
      {
        text: "Nettoyez-vous r√©guli√®rement vos lunettes ou lentilles ?",
        options: [
          { text: "Oui, quotidiennement", value: 'a' },
          { text: "Quelques fois par semaine", value: 'b' },
          { text: "Rarement", value: 'c' }
        ],
      },
      {
        text: "Prenez-vous des pauses r√©guli√®res lors du travail sur √©cran ?",
        options: [
          { text: "Oui, r√®gle 20-20-20", value: 'a' },
          { text: "Parfois", value: 'b' },
          { text: "Rarement", value: 'c' }
        ],
      }
    ]
  },
  {
    id: 'selection-lentilles',
    title: 'S√©lection de Lentilles de Contact',
    icon: 'üëÅÔ∏è‚Äçüó®Ô∏è',
    description: 'D√©couvrez le type de lentilles adapt√© √† votre style de vie',
    questionCount: 11,
    duration: '6 min',
    questions: [
      {
        text: "Combien d'heures par jour pr√©voyez-vous porter des lentilles ?",
        options: [
          { text: "Moins de 8 heures", value: 'a' },
          { text: "8 √† 12 heures", value: 'b' },
          { text: "Plus de 12 heures", value: 'c' }
        ],
      },
      {
        text: "Avez-vous les yeux sensibles ou secs ?",
        options: [
          { text: "Non", value: 'a' },
          { text: "Parfois", value: 'b' },
          { text: "Souvent", value: 'c' }
        ],
      },
      {
        text: "Pr√©f√©rez-vous des lentilles jetables quotidiennes ou mensuelles ?",
        options: [
          { text: "Quotidiennes", value: 'a' },
          { text: "Mensuelles", value: 'b' },
          { text: "Je ne sais pas", value: 'c' }
        ],
      },
      {
        text: "Pratiquez-vous des sports ou activit√©s physiques intenses ?",
        options: [
          { text: "Oui, r√©guli√®rement", value: 'a' },
          { text: "Occasionnellement", value: 'b' },
          { text: "Non", value: 'c' }
        ],
      },
      {
        text: "Travaillez-vous dans un environnement climatis√© ou sec ?",
        options: [
          { text: "Oui, quotidiennement", value: 'a' },
          { text: "Parfois", value: 'b' },
          { text: "Non", value: 'c' }
        ],
      },
      {
        text: "Avez-vous d√©j√† port√© des lentilles de contact ?",
        options: [
          { text: "Oui, r√©guli√®rement", value: 'a' },
          { text: "Oui, mais arr√™t√©", value: 'b' },
          { text: "Non, jamais", value: 'c' }
        ],
      },
      {
        text: "√ätes-vous pr√™t √† entretenir vos lentilles quotidiennement ?",
        options: [
          { text: "Oui, sans probl√®me", value: 'a' },
          { text: "Si n√©cessaire", value: 'b' },
          { text: "Pr√©f√®re √©viter", value: 'c' }
        ],
      },
      {
        text: "Souhaitez-vous des lentilles color√©es ou correctrices uniquement ?",
        options: [
          { text: "Correctrices uniquement", value: 'a' },
          { text: "Color√©es", value: 'b' },
          { text: "Les deux", value: 'c' }
        ],
      },
      {
        text: "Avez-vous un astigmatisme ?",
        options: [
          { text: "Non", value: 'a' },
          { text: "Oui, l√©ger", value: 'b' },
          { text: "Oui, important", value: 'c' }
        ],
      },
      {
        text: "Dormez-vous parfois avec vos lentilles (si applicable) ?",
        options: [
          { text: "Jamais", value: 'a' },
          { text: "Rarement", value: 'b' },
          { text: "Parfois", value: 'c' }
        ],
      },
      {
        text: "Quel est votre budget mensuel pour les lentilles ?",
        options: [
          { text: "Moins de 15 000 FCFA", value: 'a' },
          { text: "15 000 - 30 000 FCFA", value: 'b' },
          { text: "Plus de 30 000 FCFA", value: 'c' }
        ],
      }
    ]
  },
  {
    id: 'prevention-fatigue',
    title: 'Pr√©vention de Fatigue Oculaire',
    icon: 'üíª',
    description: 'Adoptez les bonnes pratiques pour prot√©ger vos yeux au quotidien',
    questionCount: 10,
    duration: '5 min',
    questions: [
      {
        text: "Combien d'heures passez-vous devant un √©cran par jour ?",
        options: [
          { text: "Moins de 4 heures", value: 'a' },
          { text: "4 √† 8 heures", value: 'b' },
          { text: "Plus de 8 heures", value: 'c' }
        ],
      },
      {
        text: "Appliquez-vous la r√®gle 20-20-20 ?",
        options: [
          { text: "Oui, syst√©matiquement", value: 'a' },
          { text: "Parfois", value: 'b' },
          { text: "Jamais", value: 'c' }
        ],
      },
      {
        text: "Votre √©cran est-il √† la bonne distance (50-70 cm) ?",
        options: [
          { text: "Oui", value: 'a' },
          { text: "Trop proche", value: 'b' },
          { text: "Trop loin", value: 'c' }
        ],
      },
      {
        text: "Clignez-vous suffisamment des yeux devant l'√©cran ?",
        options: [
          { text: "Oui, r√©guli√®rement", value: 'a' },
          { text: "Je ne sais pas", value: 'b' },
          { text: "Rarement, j'oublie", value: 'c' }
        ],
      },
      {
        text: "Votre √©cran est-il positionn√© sous le niveau des yeux ?",
        options: [
          { text: "Oui, l√©g√®rement en dessous", value: 'a' },
          { text: "Au niveau des yeux", value: 'b' },
          { text: "Au-dessus", value: 'c' }
        ],
      },
      {
        text: "Quel est l'√©clairage de votre poste de travail ?",
        options: [
          { text: "Lumi√®re naturelle + lampe d'appoint", value: 'a' },
          { text: "Lumi√®re artificielle uniquement", value: 'b' },
          { text: "√âcran dans le noir", value: 'c' }
        ],
      },
      {
        text: "Utilisez-vous un filtre anti-lumi√®re bleue ?",
        options: [
          { text: "Oui, sur mes lunettes ou √©cran", value: 'a' },
          { text: "Non, mais j'utilise un mode nuit", value: 'b' },
          { text: "Non, rien du tout", value: 'c' }
        ],
      },
      {
        text: "Pratiquez-vous des exercices oculaires ?",
        options: [
          { text: "Oui, r√©guli√®rement (palming, rotations)", value: 'a' },
          { text: "Rarement", value: 'b' },
          { text: "Jamais", value: 'c' }
        ],
      },
      {
        text: "Quelle est votre posture devant l'√©cran ?",
        options: [
          { text: "Dos droit, pieds au sol", value: 'a' },
          { text: "Avachi(e)", value: 'b' },
          { text: "Variable", value: 'c' }
        ],
      },
      {
        text: "Prenez-vous des pauses r√©guli√®res (toutes les heures) ?",
        options: [
          { text: "Oui, syst√©matiquement", value: 'a' },
          { text: "Parfois", value: 'b' },
          { text: "Rarement", value: 'c' }
        ],
      }
    ]
  },
  {
    id: 'selection-traitement',
    title: 'S√©lection de Traitement',
    icon: '‚öïÔ∏è',
    description: 'Identifiez les options de traitement adapt√©es √† vos besoins visuels',
    questionCount: 13,
    duration: '7 min',
    questions: [
      {
        text: "Quel est votre principal probl√®me visuel ?",
        options: [
          { text: "Myopie", value: 'a' },
          { text: "Hyperm√©tropie", value: 'b' },
          { text: "Astigmatisme", value: 'c' }
        ],
      },
      {
        text: "Avez-vous envisag√© la chirurgie r√©fractive ?",
        options: [
          { text: "Oui, int√©ress√©(e)", value: 'a' },
          { text: "Peut-√™tre", value: 'b' },
          { text: "Non", value: 'c' }
        ],
      },
      {
        text: "Votre correction optique est-elle stable depuis plus de 2 ans ?",
        options: [
          { text: "Oui", value: 'a' },
          { text: "Non", value: 'b' },
          { text: "Je ne sais pas", value: 'c' }
        ],
      },
      {
        text: "Avez-vous plus de 18 ans ?",
        options: [
          { text: "Oui", value: 'a' },
          { text: "Non", value: 'b' },
          { text: "Entre 16 et 18 ans", value: 'c' }
        ],
      },
      {
        text: "Quelle est l'√©paisseur de votre corn√©e (si connue) ?",
        options: [
          { text: "Normale (>500 ¬µm)", value: 'a' },
          { text: "Fine (<500 ¬µm)", value: 'b' },
          { text: "Je ne sais pas", value: 'c' }
        ],
      },
      {
        text: "Avez-vous des maladies auto-immunes ou du diab√®te ?",
        options: [
          { text: "Non", value: 'a' },
          { text: "Oui, diab√®te", value: 'b' },
          { text: "Oui, autre maladie auto-immune", value: 'c' }
        ],
      },
      {
        text: "√ätes-vous pr√™t(e) √† accepter les risques d'une chirurgie ?",
        options: [
          { text: "Oui, apr√®s information compl√®te", value: 'a' },
          { text: "J'ai des doutes", value: 'b' },
          { text: "Non, trop risqu√©", value: 'c' }
        ],
      },
      {
        text: "Quel type de chirurgie vous int√©resse le plus ?",
        options: [
          { text: "LASIK", value: 'a' },
          { text: "PKR (sans d√©coupe)", value: 'b' },
          { text: "Implants phakes", value: 'c' }
        ],
      },
      {
        text: "Pouvez-vous prendre 1 semaine de repos post-op√©ratoire ?",
        options: [
          { text: "Oui, facilement", value: 'a' },
          { text: "Difficile mais possible", value: 'b' },
          { text: "Non", value: 'c' }
        ],
      },
      {
        text: "Avez-vous des attentes r√©alistes sur les r√©sultats ?",
        options: [
          { text: "Oui, 20/20 n'est pas garanti", value: 'a' },
          { text: "J'attends une vision parfaite", value: 'b' },
          { text: "Je ne sais pas", value: 'c' }
        ],
      },
      {
        text: "Quel est votre budget pour une chirurgie r√©fractive ?",
        options: [
          { text: "500 000 - 1 000 000 FCFA par ≈ìil", value: 'a' },
          { text: "Moins de 500 000 FCFA", value: 'b' },
          { text: "Plus de 1 000 000 FCFA", value: 'c' }
        ],
      },
      {
        text: "Pr√©f√©rez-vous une correction temporaire ou permanente ?",
        options: [
          { text: "Permanente (chirurgie)", value: 'a' },
          { text: "Temporaire (lunettes/lentilles)", value: 'b' },
          { text: "Je ne sais pas encore", value: 'c' }
        ],
      },
      {
        text: "Acceptez-vous un suivi post-op√©ratoire r√©gulier ?",
        options: [
          { text: "Oui, je m'y engage", value: 'a' },
          { text: "Si n√©cessaire", value: 'b' },
          { text: "Non, pas le temps", value: 'c' }
        ],
      }
    ]
  }
]);

// --- Types de Tests disponibles ---
const testTypes = ref([
  {
    id: 'acuite',
    title: 'Test d\'Acuit√© Visuelle',
    icon: 'üëÅÔ∏è',
    description: '√âvaluez votre capacit√© √† distinguer les d√©tails √† distance',
    stepCount: 5,
    duration: '3 min',
    type: 'interactive'
  },
  {
    id: 'myopie',
    title: 'Test de D√©pistage Myopie',
    icon: 'üîç',
    description: '√âvaluez votre vision de loin et d√©tectez une √©ventuelle myopie',
    stepCount: 6,
    duration: '3 min',
    type: 'interactive'
  },
  {
    id: 'hypermetropie',
    title: 'Test de D√©pistage Hyperm√©tropie',
    icon: 'üìñ',
    description: '√âvaluez votre vision de pr√®s et d√©tectez une √©ventuelle hyperm√©tropie',
    stepCount: 6,
    duration: '3 min',
    type: 'interactive'
  },
  {
    id: 'daltonisme',
    title: 'Test de Daltonisme',
    icon: 'üé®',
    description: 'D√©tectez une √©ventuelle d√©ficience de perception des couleurs (Ishihara)',
    stepCount: 8,
    duration: '4 min',
    type: 'interactive'
  },
  {
    id: 'astigmatisme',
    title: 'Test d\'Astigmatisme',
    icon: '‚≠ê',
    description: 'Identifiez une d√©formation de la corn√©e affectant la vision',
    stepCount: 4,
    duration: '2 min',
    type: 'interactive'
  },
  {
    id: 'amsler',
    title: 'Grille d\'Amsler (DMLA)',
    icon: 'üî≤',
    description: 'D√©pistage pr√©coce de la d√©g√©n√©rescence maculaire li√©e √† l\'√¢ge',
    stepCount: 3,
    duration: '2 min',
    type: 'interactive'
  },
  {
    id: 'contraste',
    title: 'Test de Sensibilit√© au Contraste',
    icon: '‚óê',
    description: '√âvaluez votre capacit√© √† percevoir les diff√©rences de luminosit√©',
    stepCount: 6,
    duration: '3 min',
    type: 'interactive'
  },
  {
    id: 'glaucome',
    title: '√âvaluation Risque Glaucome',
    icon: '‚öïÔ∏è',
    description: 'Questionnaire sur les facteurs de risque du glaucome',
    stepCount: 10,
    duration: '5 min',
    type: 'questionnaire'
  },
  {
    id: 'secheresse',
    title: 'Test de S√©cheresse Oculaire',
    icon: 'üíß',
    description: 'Identifiez les sympt√¥mes de l\'≈ìil sec',
    stepCount: 8,
    duration: '4 min',
    type: 'questionnaire'
  },
  {
    id: 'cataracte',
    title: '√âvaluation Cataracte',
    icon: '‚òÅÔ∏è',
    description: 'D√©tectez les signes pr√©coces de la cataracte',
    stepCount: 7,
    duration: '3 min',
    type: 'questionnaire'
  }
]);

const selectQuiz = (quiz) => {
  selectedQuizType.value = quiz;
  selectedTestType.value = null; // D√©s√©lectionner le test
  closeQuizModal();
  // Charger les questions du quiz s√©lectionn√©
  questions.value = quiz.questions;
  resetQuiz();
  quizCompleted.value = false;

  // Scroll automatique vers la section quiz/test
  setTimeout(() => {
    const section = document.querySelector('#quiz-test-section');
    if (section) {
      section.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  }, 100);
};

const selectTest = (test) => {
  selectedTestType.value = test;
  selectedQuizType.value = null; // D√©s√©lectionner le quiz
  closeTestModal();
  testFormSubmitted.value = false;
  testSubmitted.value = false;

  // Scroll automatique vers la section quiz/test
  setTimeout(() => {
    const section = document.querySelector('#quiz-test-section');
    if (section) {
      section.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  }, 100);
};

const submitTestForm = () => {
  if (!testFormData.value.name || !testFormData.value.email) return;
  testFormSubmitted.value = true;

  // Scroll pour voir le test qui s'affiche
  setTimeout(() => {
    const section = document.querySelector('#quiz-test-section');
    if (section) {
      section.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  }, 100);
};

const completeTest = () => {
  testCompleted.value = true;

  // Envoyer les donn√©es au backend
  console.log('Test compl√©t√©:', {
    test: selectedTestType.value.title,
    formData: testFormData.value,
    answers: testAnswers.value
  });

  // Scroller vers le message de confirmation
  setTimeout(() => {
    if (testCompletionMessage.value) {
      testCompletionMessage.value.scrollIntoView({
        behavior: 'smooth',
        block: 'center'
      });
    }
  }, 100);
};

const resetTestSelection = () => {
  selectedTestType.value = null;
  testFormSubmitted.value = false;
  testSubmitted.value = false;
  testCompleted.value = false;
  currentTestStep.value = 0;
  testAnswers.value = [];
  testFormData.value = {
    name: '',
    email: '',
    phone: ''
  };
};

const answerTestQuestion = (answer) => {
  testAnswers.value[currentTestStep.value] = answer;
};

const nextTestStep = () => {
  if (currentTestStep.value < selectedTestType.value.stepCount - 1) {
    currentTestStep.value++;

    // Scroll automatique vers le haut du test
    setTimeout(() => {
      const section = document.querySelector('#quiz-test-section');
      if (section) {
        section.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }, 10);
  }
};

const previousTestStep = () => {
  if (currentTestStep.value > 0) {
    currentTestStep.value--;

    // Scroll automatique vers le haut du test
    setTimeout(() => {
      const section = document.querySelector('#quiz-test-section');
      if (section) {
        section.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }, 10);
  }
};

const getCurrentTestStep = () => {
  if (!selectedTestType.value) return null;

  const testId = selectedTestType.value.id;
  const step = currentTestStep.value;

  // D√©finir les √©tapes pour chaque type de test
  const testSteps = {
    acuite: [
      { title: 'Distance 5m - Taille Grande', instruction: 'Identifiez la lettre affich√©e', description: 'Placez-vous √† 5 m√®tres de l\'√©cran', letter: 'E', size: '120px', options: ['E', 'F', 'L', 'P'] },
      { title: 'Distance 5m - Taille Moyenne', instruction: 'Identifiez la lettre affich√©e', description: 'Maintenez la m√™me distance', letter: 'T', size: '80px', options: ['T', 'L', 'I', 'F'] },
      { title: 'Distance 5m - Taille Petite', instruction: 'Identifiez la lettre affich√©e', description: 'Concentrez-vous bien', letter: 'P', size: '60px', options: ['P', 'R', 'B', 'D'] },
      { title: 'Distance 5m - Taille Tr√®s Petite', instruction: 'Identifiez la lettre affich√©e', description: 'Derni√®re lettre de grande distance', letter: 'Z', size: '50px', options: ['Z', 'N', 'M', 'W'] },
      { title: 'Distance 3m - Lecture', instruction: 'Identifiez la lettre affich√©e', description: 'Rapprochez-vous √† 3 m√®tres', letter: 'H', size: '40px', options: ['H', 'N', 'M', 'U'] }
    ],
    myopie: [
      { title: 'Vision de loin - Grande taille', instruction: 'Pouvez-vous lire cette lettre √† 5m ?', description: 'Placez-vous √† 5 m√®tres de l\'√©cran', letter: 'C', size: '100px', options: ['Oui, nettement', 'Oui, mais flou', 'Difficilement', 'Non'] },
      { title: 'Vision de loin - Taille moyenne', instruction: 'Cette lettre est-elle nette ?', description: 'Restez √† 5 m√®tres', letter: 'F', size: '70px', options: ['Oui, tr√®s nette', 'L√©g√®rement floue', 'Floue', 'Tr√®s floue'] },
      { title: 'Vision de loin - Petite taille', instruction: 'Distinguez-vous cette lettre ?', description: 'Distance 5 m√®tres', letter: 'N', size: '50px', options: ['Oui, clairement', 'Avec effort', '√Ä peine', 'Non'] },
      { title: 'Panneau routier simul√©', instruction: 'Pouvez-vous lire ce texte de loin ?', description: 'Imaginez un panneau √† distance', question: 'Lisez-vous "STOP" clairement √† 20m ?', options: ['Oui, facilement', 'Difficilement', 'Non'] },
      { title: 'Sympt√¥mes quotidiens', instruction: 'D√©crivez votre exp√©rience', description: '', question: 'Plissez-vous les yeux pour voir au loin ?', options: ['Oui, souvent', 'Parfois', 'Rarement', 'Jamais'] },
      { title: 'Fatigue visuelle', instruction: 'Perception de l\'effort', description: '', question: 'Ressentez-vous une fatigue apr√®s avoir regard√© au loin ?', options: ['Oui, rapidement', 'Apr√®s un moment', 'Rarement', 'Jamais'] }
    ],
    hypermetropie: [
      { title: 'Vision de pr√®s - Lecture', instruction: 'Pouvez-vous lire ce texte √† 30cm ?', description: 'Tenez votre t√©l√©phone √† 30cm', letter: 'LECTURE', size: '24px', options: ['Oui, nettement', 'Oui, mais flou', 'Difficilement', 'Non'] },
      { title: 'Vision de pr√®s - Texte petit', instruction: 'Ce texte est-il net de pr√®s ?', description: 'Distance 30cm', letter: 'petit texte', size: '16px', options: ['Oui, tr√®s net', 'L√©g√®rement flou', 'Flou', 'Tr√®s flou'] },
      { title: 'Vision de pr√®s - Tr√®s petit', instruction: 'Distinguez-vous ces caract√®res ?', description: 'Lecture fine', letter: 'abc123', size: '12px', options: ['Oui, clairement', 'Avec effort', '√Ä peine', 'Non'] },
      { title: 'Lecture prolong√©e', instruction: 'Exp√©rience quotidienne', description: '', question: 'Ressentez-vous une fatigue en lisant ?', options: ['Oui, rapidement', 'Apr√®s 15-30 min', 'Apr√®s 1h+', 'Non'] },
      { title: 'Maux de t√™te', instruction: 'Sympt√¥mes associ√©s', description: '', question: 'Avez-vous des maux de t√™te apr√®s lecture ou travail de pr√®s ?', options: ['Oui, fr√©quemment', 'Parfois', 'Rarement', 'Jamais'] },
      { title: 'Effort d\'accommodation', instruction: 'Observation personnelle', description: '', question: 'Devez-vous √©loigner les objets pour mieux les voir ?', options: ['Oui, toujours', 'Souvent', 'Parfois', 'Non'] }
    ],
    daltonisme: [
      { title: 'Planche 1 - Rouge/Vert', instruction: 'Quel chiffre voyez-vous ?', description: 'Observez attentivement le cercle color√©', number: '12', color: '#D4A5A5', options: ['12', '13', '21', 'Aucun'] },
      { title: 'Planche 2 - Rouge/Vert', instruction: 'Quel chiffre voyez-vous ?', description: 'Concentrez-vous sur les points', number: '8', color: '#C5B8A8', options: ['8', '3', '6', 'Aucun'] },
      { title: 'Planche 3 - Rouge/Vert', instruction: 'Quel chiffre voyez-vous ?', description: 'Identifiez le nombre', number: '5', color: '#B8C5A8', options: ['5', '2', '6', 'Aucun'] },
      { title: 'Planche 4 - Rouge/Vert', instruction: 'Quel chiffre voyez-vous ?', description: 'Dernier test rouge/vert', number: '74', color: '#A8B8A8', options: ['74', '21', '71', 'Aucun'] },
      { title: 'Planche 5 - Bleu/Jaune', instruction: 'Quel chiffre voyez-vous ?', description: 'Test de d√©ficience bleu/jaune', number: '6', color: '#B8B8C5', options: ['6', '5', '8', 'Aucun'] },
      { title: 'Planche 6 - Bleu/Jaune', instruction: 'Quel chiffre voyez-vous ?', description: 'Suite du test bleu/jaune', number: '45', color: '#C5C5A8', options: ['45', '15', '43', 'Aucun'] },
      { title: 'Planche 7 - Complexe', instruction: 'Quel chiffre voyez-vous ?', description: 'Test avanc√©', number: '2', color: '#B8A8B8', options: ['2', '5', '7', 'Aucun'] },
      { title: 'Planche 8 - Complexe', instruction: 'Quel chiffre voyez-vous ?', description: 'Derni√®re planche', number: '16', color: '#A8B8C5', options: ['16', '18', '15', 'Aucun'] }
    ],
    astigmatisme: [
      { title: 'Vue d\'ensemble', instruction: 'Toutes les lignes ont-elles la m√™me nettet√© ?', description: 'Observez les 12 lignes radiales', lineWidth: 3, options: ['Oui, toutes nettes', 'Non, certaines floues', 'Je ne sais pas'] },
      { title: 'Lignes verticales/horizontales', instruction: 'Les lignes verticales et horizontales sont-elles aussi nettes ?', description: 'Comparez leur nettet√©', lineWidth: 3, options: ['Oui, √©quivalentes', 'Les verticales plus nettes', 'Les horizontales plus nettes'] },
      { title: 'Lignes diagonales', instruction: 'Les lignes diagonales sont-elles nettes ?', description: 'Observez les lignes √† 45¬∞', lineWidth: 3, options: ['Oui, tr√®s nettes', 'L√©g√®rement floues', 'Tr√®s floues'] },
      { title: '√âvaluation globale', instruction: 'Y a-t-il des zones de flou particuli√®res ?', description: 'Vue finale', lineWidth: 3, options: ['Non, tout est net', 'Oui, dans certaines directions', 'Difficile √† dire'] }
    ],
    amsler: [
      { title: '≈íil droit', instruction: 'Fixez le point central. Voyez-vous des lignes d√©form√©es ?', description: 'Couvrez votre ≈ìil gauche', options: ['Non, grille parfaite', 'Oui, lignes ondul√©es', 'Oui, zones manquantes', 'Oui, taches sombres'] },
      { title: '≈íil gauche', instruction: 'Fixez le point central. Voyez-vous des lignes d√©form√©es ?', description: 'Couvrez votre ≈ìil droit', options: ['Non, grille parfaite', 'Oui, lignes ondul√©es', 'Oui, zones manquantes', 'Oui, taches sombres'] },
      { title: 'Vision binoculaire', instruction: 'Avec les deux yeux, la grille est-elle uniforme ?', description: 'Observez avec les deux yeux ouverts', options: ['Oui, grille normale', 'Non, d√©formations pr√©sentes', 'Incertain'] }
    ],
    contraste: [
      { title: 'Contraste √©lev√©', instruction: 'Voyez-vous clairement la lettre ?', description: 'Contraste noir sur blanc', question: 'La lettre E est-elle visible ?', options: ['Oui, tr√®s nette', 'Oui, mais flou', 'Difficile', 'Non visible'] },
      { title: 'Contraste moyen', instruction: 'Voyez-vous la lettre ?', description: 'Contraste gris fonc√© sur blanc', question: 'La lettre T est-elle visible ?', options: ['Oui, nette', 'Oui, mais effort', 'Tr√®s difficile', 'Non visible'] },
      { title: 'Contraste faible', instruction: 'Voyez-vous la lettre ?', description: 'Contraste gris sur blanc', question: 'La lettre O est-elle visible ?', options: ['Oui', '√Ä peine', 'Non visible'] },
      { title: 'Contraste tr√®s faible', instruction: 'Voyez-vous la lettre ?', description: 'Contraste gris clair sur blanc', question: 'La lettre C est-elle visible ?', options: ['Oui', 'Non visible'] },
      { title: 'Vision nocturne simul√©e', instruction: 'Dans un environnement sombre, distinguez-vous les formes ?', description: 'Baissez la luminosit√© de votre √©cran', question: 'Voyez-vous des formes ?', options: ['Oui, clairement', 'Difficilement', 'Non'] },
      { title: '√âblouissement', instruction: 'Apr√®s un flash lumineux, r√©cup√©rez-vous rapidement ?', description: 'Imaginez une lumi√®re forte', question: 'Temps de r√©cup√©ration habituel ?', options: ['< 5 secondes', '5-10 secondes', '> 10 secondes'] }
    ],
    glaucome: [
      { title: 'Ant√©c√©dents familiaux', instruction: 'R√©pondez honn√™tement', description: '', question: 'Avez-vous des ant√©c√©dents familiaux de glaucome ?', options: ['Oui, parent direct', 'Oui, famille √©loign√©e', 'Non', 'Je ne sais pas'] },
      { title: '√Çge', instruction: 'Indiquez votre tranche d\'√¢ge', description: '', question: 'Quel est votre √¢ge ?', options: ['< 40 ans', '40-60 ans', '> 60 ans'] },
      { title: 'Pression oculaire', instruction: 'Si vous la connaissez', description: '', question: 'Votre pression oculaire a-t-elle d√©j√† √©t√© mesur√©e √©lev√©e ?', options: ['Oui', 'Non', 'Jamais mesur√©e'] },
      { title: 'Vision p√©riph√©rique', instruction: 'Observation quotidienne', description: '', question: 'Avez-vous remarqu√© une r√©duction de votre vision lat√©rale ?', options: ['Oui, significative', 'L√©g√®rement', 'Non'] },
      { title: 'Douleurs oculaires', instruction: 'Dans les 6 derniers mois', description: '', question: 'Ressentez-vous des douleurs oculaires ou maux de t√™te ?', options: ['Oui, fr√©quemment', 'Parfois', 'Rarement', 'Jamais'] },
      { title: 'Halos lumineux', instruction: 'Surtout la nuit', description: '', question: 'Voyez-vous des halos autour des lumi√®res ?', options: ['Oui, souvent', 'Occasionnellement', 'Non'] },
      { title: 'Diab√®te', instruction: 'Facteur de risque', description: '', question: '√ätes-vous diab√©tique ?', options: ['Oui', 'Non', 'Pr√©-diab√®te'] },
      { title: 'Myopie forte', instruction: 'Degr√© de myopie', description: '', question: 'Avez-vous une forte myopie (> -6 dioptries) ?', options: ['Oui', 'Non', 'Je ne sais pas'] },
      { title: 'Traitement cortico√Ødes', instruction: 'M√©dicaments', description: '', question: 'Prenez-vous r√©guli√®rement des cortico√Ødes ?', options: ['Oui, long terme', 'Oui, ponctuel', 'Non'] },
      { title: 'Suivi ophtalmologique', instruction: 'Derni√®re consultation', description: '', question: 'Quand avez-vous consult√© un ophtalmologue ?', options: ['< 1 an', '1-2 ans', '> 2 ans', 'Jamais'] }
    ],
    secheresse: [
      { title: 'Sensation de s√©cheresse', instruction: 'Fr√©quence', description: '', question: 'Ressentez-vous vos yeux secs ?', options: ['Constamment', 'Souvent', 'Parfois', 'Rarement', 'Jamais'] },
      { title: 'Sensation de br√ªlure', instruction: 'Inconfort', description: '', question: 'Vos yeux vous br√ªlent-ils ?', options: ['Toujours', 'Fr√©quemment', 'Occasionnellement', 'Jamais'] },
      { title: 'Larmoiement', instruction: 'Paradoxalement', description: '', question: 'Vos yeux larmoient-ils excessivement ?', options: ['Oui, beaucoup', 'Mod√©r√©ment', 'Peu', 'Pas du tout'] },
      { title: 'Sensation de corps √©tranger', instruction: 'Comme du sable', description: '', question: 'Avez-vous l\'impression d\'avoir quelque chose dans l\'≈ìil ?', options: ['Constamment', 'Souvent', 'Parfois', 'Jamais'] },
      { title: 'Fatigue visuelle', instruction: 'Apr√®s √©crans', description: '', question: 'Vos yeux sont-ils fatigu√©s apr√®s l\'usage d\'√©crans ?', options: ['Tr√®s rapidement', 'Apr√®s 1-2h', 'Apr√®s > 3h', 'Rarement'] },
      { title: 'Vision floue intermittente', instruction: 'Qui s\'am√©liore en clignant', description: '', question: 'Votre vision devient-elle floue puis s\'√©claircit ?', options: ['Oui, fr√©quemment', 'Parfois', 'Rarement', 'Jamais'] },
      { title: 'Rougeur oculaire', instruction: 'Apparence', description: '', question: 'Vos yeux sont-ils souvent rouges ?', options: ['Constamment', 'Souvent', 'Occasionnellement', 'Non'] },
      { title: 'Environnement', instruction: 'Facteurs d√©clenchants', description: '', question: 'Les sympt√¥mes s\'aggravent-ils dans certains environnements (climatisation, vent) ?', options: ['Oui, beaucoup', 'L√©g√®rement', 'Non'] }
    ],
    cataracte: [
      { title: 'Vision floue', instruction: 'Progressive', description: '', question: 'Votre vision est-elle devenue progressivement floue ?', options: ['Oui, significativement', 'L√©g√®rement', 'Non'] },
      { title: '√âblouissement', instruction: 'Sensibilit√© √† la lumi√®re', description: '', question: '√ätes-vous g√™n√© par les lumi√®res vives ?', options: ['Oui, tr√®s', 'Mod√©r√©ment', 'Non'] },
      { title: 'Halos', instruction: 'Autour des lumi√®res', description: '', question: 'Voyez-vous des halos autour des lumi√®res la nuit ?', options: ['Oui, toujours', 'Parfois', 'Non'] },
      { title: 'Vision nocturne', instruction: 'Conduite de nuit', description: '', question: 'Avez-vous des difficult√©s √† conduire la nuit ?', options: ['Oui, importantes', 'Quelques difficult√©s', 'Non'] },
      { title: 'Couleurs', instruction: 'Perception', description: '', question: 'Les couleurs vous semblent-elles ternes ou jaunies ?', options: ['Oui, nettement', 'L√©g√®rement', 'Non'] },
      { title: 'Double vision', instruction: 'Monoculaire', description: '', question: 'Voyez-vous double avec un seul ≈ìil ?', options: ['Oui', 'Parfois', 'Non'] },
      { title: '√Çge', instruction: 'Facteur principal', description: '', question: 'Quel est votre √¢ge ?', options: ['< 50 ans', '50-65 ans', '> 65 ans'] }
    ]
  };

  return testSteps[testId]?.[step] || { title: '√âtape', instruction: '', description: '', options: [] };
};

// --- Data pour le Quiz ---
const questions = ref([
  {
    text: "Quel est votre principal environnement d'utilisation ?",
    options: [
      { text: "Principalement √† l'int√©rieur (bureau, √©cran)", value: 'indoor' },
      { text: "Principalement √† l'ext√©rieur (conduite, sport)", value: 'outdoor' },
      { text: "Les deux √©quitablement", value: 'mixed' },
    ]
  },
  {
    text: "Quel crit√®re est le plus important pour vous ?",
    options: [
      { text: "La r√©sistance et la durabilit√©", value: 'durability' },
      { text: "Le style et la mode", value: 'style' },
      { text: "Le poids et le confort (l√©g√®ret√©)", value: 'comfort' },
    ]
  },
  {
    text: "Quel est votre budget principal pour les montures ?",
    options: [
      { text: "Moins de 50 000 XOF (Bas)", value: 'low' },
      { text: "50 000 - 100 000 XOF (Moyen)", value: 'medium' },
      { text: "Plus de 100 000 XOF (Premium)", value: 'high' },
    ]
  }
]);

const answers = ref(new Array(questions.value.length).fill(null));
const quizCompleted = ref(false);
const isCalculating = ref(false);
const resultMessage = ref('');
const currentQuestionPage = ref(0);
const questionsPerPage = 3;

// Questions affich√©es sur la page actuelle
const displayedQuestions = computed(() => {
  const start = currentQuestionPage.value * questionsPerPage;
  const end = start + questionsPerPage;
  return questions.value.slice(start, end).map((q, idx) => ({
    ...q,
    globalIndex: start + idx
  }));
});

// Nombre total de pages
const totalPages = computed(() => {
  return Math.ceil(questions.value.length / questionsPerPage);
});

// V√©rifie si les questions de la page actuelle sont toutes r√©pondues
const isCurrentPageValid = computed(() => {
  const start = currentQuestionPage.value * questionsPerPage;
  const end = Math.min(start + questionsPerPage, questions.value.length);
  for (let i = start; i < end; i++) {
    if (answers.value[i] === null) return false;
  }
  return true;
});

// V√©rifie si toutes les questions ont re√ßu une r√©ponse
const isQuizValid = computed(() => {
  return answers.value.every(answer => answer !== null);
});

const nextPage = () => {
  if (currentQuestionPage.value < totalPages.value - 1) {
    currentQuestionPage.value++;
    setTimeout(() => {
      const section = document.querySelector('#quiz-test-section');
      if (section) {
        section.scrollIntoView({ behavior: 'auto', block: 'start' });
      }
    }, 10);
  }
};

const previousPage = () => {
  if (currentQuestionPage.value > 0) {
    currentQuestionPage.value--;
    setTimeout(() => {
      const section = document.querySelector('#quiz-test-section');
      if (section) {
        section.scrollIntoView({ behavior: 'auto', block: 'start' });
      }
    }, 10);
  }
};

// --- Logique du Quiz ---
const calculateResults = () => {
  if (!isQuizValid.value) return;

  console.log('üî• calculateResults appel√© - Affichage √©cran de chargement');
  isCalculating.value = true;
  console.log('‚úÖ isCalculating =', isCalculating.value);

  // Simuler un temps de traitement professionnel (8 secondes)
  setTimeout(() => {
    let diagnostic = "";
    const quizId = selectedQuizType.value.id;
    const userAnswers = answers.value;

    // Analyser les r√©ponses selon le quiz
    if (quizId === 'depistage-vision') {
      // Quiz D√©pistage de Probl√®mes de Vision (12 questions)
      let symptoms = [];

      // Q0: Difficult√©s √† voir les objets √©loign√©s
      if (userAnswers[0] === 'b' || userAnswers[0] === 'c') symptoms.push("difficult√© √† voir de loin");

      // Q1: Maux de t√™te apr√®s lecture prolong√©e
      if (userAnswers[1] === 'b' || userAnswers[1] === 'c') symptoms.push("maux de t√™te fr√©quents");

      // Q2: Besoin de plisser les yeux pour lire de loin
      if (userAnswers[2] === 'b' || userAnswers[2] === 'c') symptoms.push("plissement des yeux");

      // Q3: Difficult√© √† lire de pr√®s
      if (userAnswers[3] === 'b' || userAnswers[3] === 'c') symptoms.push("difficult√© √† lire de pr√®s");

      // Q4: Halos autour des lumi√®res la nuit
      if (userAnswers[4] === 'b' || userAnswers[4] === 'c') symptoms.push("halos lumineux");

      // Q5: Yeux rouges ou irrit√©s
      if (userAnswers[5] === 'b' || userAnswers[5] === 'c') symptoms.push("yeux rouges/irrit√©s");

      // Q6: Vision double occasionnelle
      if (userAnswers[6] === 'b' || userAnswers[6] === 'c') symptoms.push("vision double");

      // Q7: Sensibilit√© excessive √† la lumi√®re
      if (userAnswers[7] === 'b' || userAnswers[7] === 'c') symptoms.push("photophobie");

      // Q8: Difficult√©s √† conduire de nuit
      if (userAnswers[8] === 'b' || userAnswers[8] === 'c') symptoms.push("difficult√©s conduite nocturne");

      // Q9: Baisse progressive de la vision
      if (userAnswers[9] === 'b' || userAnswers[9] === 'c') symptoms.push("baisse de vision progressive");

      // Q10: Ant√©c√©dents familiaux
      if (userAnswers[10] === 'b' || userAnswers[10] === 'c') symptoms.push("ant√©c√©dents familiaux");

      // Q11: Dernier examen de vue
      if (userAnswers[11] === 'b' || userAnswers[11] === 'c') symptoms.push("suivi m√©dical insuffisant");

      if (symptoms.length >= 5) {
        diagnostic = `üö® Diagnostic : Plusieurs sympt√¥mes pr√©occupants d√©tect√©s.\n\nNous avons identifi√© les signes suivants : ${symptoms.join(', ')}. Cette combinaison n√©cessite une consultation ophtalmologique approfondie dans les plus brefs d√©lais. Ces sympt√¥mes peuvent indiquer des troubles de r√©fraction (myopie, hyperm√©tropie, astigmatisme) ou d'autres pathologies n√©cessitant une correction urgente.\n\nRecommandation : Prenez rendez-vous pour un examen complet avec mesure de l'acuit√© visuelle et r√©fraction.`;
      } else if (symptoms.length >= 2) {
        diagnostic = `‚ö†Ô∏è Diagnostic : Signes de troubles visuels mod√©r√©s.\n\nNous d√©tectons : ${symptoms.join(', ')}. Ces sympt√¥mes sugg√®rent un possible besoin de correction visuelle ou d'ajustement de votre correction actuelle. Il est recommand√© de consulter un opticien pour v√©rifier votre vue.\n\nRecommandation : Examen de routine conseill√© dans le mois. Une correction adapt√©e pourrait grandement am√©liorer votre confort quotidien.`;
      } else {
        diagnostic = `‚úÖ Diagnostic : Vision apparemment stable.\n\nVos r√©ponses n'indiquent pas de sympt√¥mes alarmants majeurs. Toutefois, maintenez une surveillance r√©guli√®re de votre sant√© visuelle.\n\nRecommandation : Examen de contr√¥le annuel recommand√© pour pr√©venir tout probl√®me futur. ${symptoms.length > 0 ? 'Surveillez les sympt√¥mes mentionn√©s : ' + symptoms.join(', ') : ''}`;
      }
    }
    else if (quizId === 'selection-lunettes') {
      // Quiz S√©lection de Lunettes (10 questions)
      let preferences = {
        morphologie: userAnswers[0],
        activite: userAnswers[1],
        style: userAnswers[2],
        materiau: userAnswers[3],
        couleur: userAnswers[4],
        taille: userAnswers[5],
        budget: userAnswers[6]
      };

      diagnostic = "üëì Profil de monture recommand√© :\n\n";

      // Morphologie du visage
      if (preferences.morphologie === 'a') {
        diagnostic += "‚Ä¢ Avec votre visage ovale, vous avez de la chance ! Presque toutes les formes vous vont. Osez l'originalit√© !\n";
      } else if (preferences.morphologie === 'b') {
        diagnostic += "‚Ä¢ Pour votre visage carr√©, optez pour des montures rondes ou ovales pour adoucir vos angles.\n";
      } else if (preferences.morphologie === 'c') {
        diagnostic += "‚Ä¢ Pour votre visage rond, privil√©giez des montures rectangulaires ou carr√©es pour affiner vos traits.\n";
      }

      // Style de vie
      if (preferences.activite === 'a') {
        diagnostic += "‚Ä¢ Lecture : Montures l√©g√®res et confortables, verres trait√©s anti-reflet pour un confort optimal.\n";
      } else if (preferences.activite === 'b') {
        diagnostic += "‚Ä¢ √âcrans intensifs : Verres anti-lumi√®re bleue indispensables, montures confortables pour port prolong√©.\n";
      } else if (preferences.activite === 'c') {
        diagnostic += "‚Ä¢ Vie sportive : Montures l√©g√®res en titane ou TR90, verres r√©sistants aux chocs.\n";
      }

      // Budget
      if (preferences.budget === 'a') {
        diagnostic += "‚Ä¢ Budget <50k FCFA : Notre gamme Standard offre d'excellents rapports qualit√©-prix.\n";
      } else if (preferences.budget === 'b') {
        diagnostic += "‚Ä¢ Budget 50-100k FCFA : Acc√©dez √† nos collections Premium avec verres trait√©s.\n";
      } else {
        diagnostic += "‚Ä¢ Budget >100k FCFA : D√©couvrez nos marques de luxe et verres haute technologie.\n";
      }

      diagnostic += "\nüìç Rendez-vous en boutique pour essayer nos mod√®les s√©lectionn√©s selon votre profil !";
    }
    else if (quizId === 'detection-maladies') {
      // Quiz D√©tection de Maladies Oculaires (15 questions)
      let risques = [];

      // Q0: Mouches volantes
      if (userAnswers[0] === 'b' || userAnswers[0] === 'c') risques.push("mouches volantes (d√©collement r√©tine possible)");

      // Q1: Perte vision p√©riph√©rique
      if (userAnswers[1] === 'b' || userAnswers[1] === 'c') risques.push("perte vision p√©riph√©rique (glaucome?)");

      // Q2: Douleurs oculaires avec vision floue
      if (userAnswers[2] === 'b' || userAnswers[2] === 'c') risques.push("douleurs oculaires");

      // Q3: √âclairs lumineux
      if (userAnswers[3] === 'b' || userAnswers[3] === 'c') risques.push("√©clairs lumineux (alerte r√©tine)");

      // Q4: Voile/rideau dans champ visuel
      if (userAnswers[4] === 'b' || userAnswers[4] === 'c') risques.push("voile/rideau visuel (urgence)");

      // Q5: Lignes d√©form√©es
      if (userAnswers[5] === 'b' || userAnswers[5] === 'c') risques.push("d√©formation des lignes (DMLA?)");

      // Q6: Vision centrale floue
      if (userAnswers[6] === 'b' || userAnswers[6] === 'c') risques.push("vision centrale floue");

      // Q7: Pression/douleur yeux
      if (userAnswers[7] === 'b' || userAnswers[7] === 'c') risques.push("pression oculaire √©lev√©e");

      // Q8: Rougeurs fr√©quentes
      if (userAnswers[8] === 'b' || userAnswers[8] === 'c') risques.push("rougeurs fr√©quentes");

      // Q9: Halos color√©s
      if (userAnswers[9] === 'b' || userAnswers[9] === 'c') risques.push("halos color√©s (glaucome?)");

      // Q10: Difficult√©s couleurs
      if (userAnswers[10] === 'b' || userAnswers[10] === 'c') risques.push("probl√®mes de perception couleurs");

      // Q11: Larmoiement excessif
      if (userAnswers[11] === 'b' || userAnswers[11] === 'c') risques.push("larmoiement excessif");

      // Q12: Diab√®te/hypertension
      if (userAnswers[12] === 'b' || userAnswers[12] === 'c') risques.push("diab√®te/hypertension (facteur risque)");

      // Q13: √Çge >60 ans
      if (userAnswers[13] === 'b' || userAnswers[13] === 'c') risques.push("√¢ge avanc√© (surveillance accrue)");

      // Q14: Traumatisme r√©cent
      if (userAnswers[14] === 'b' || userAnswers[14] === 'c') risques.push("traumatisme oculaire r√©cent");

      if (risques.length >= 4) {
        diagnostic = `üö® ALERTE : Signes de pathologies oculaires graves possibles.\n\nSympt√¥mes d√©tect√©s : ${risques.join(', ')}.\n\nCette combinaison de sympt√¥mes n√©cessite une CONSULTATION OPHTALMOLOGIQUE URGENTE. Ces signes peuvent indiquer :\n- DMLA (D√©g√©n√©rescence Maculaire)\n- Glaucome\n- D√©collement de r√©tine\n- R√©tinopathie diab√©tique\n\n‚ö†Ô∏è NE PAS ATTENDRE : Certains de ces sympt√¥mes constituent des urgences ophtalmologiques. Un diagnostic et traitement pr√©coces sont cruciaux pour pr√©server votre vision.`;
      } else if (risques.length >= 2) {
        diagnostic = `‚ö†Ô∏è Diagnostic : Facteurs de risque identifi√©s.\n\n√âl√©ments pr√©occupants : ${risques.join(', ')}.\n\nCes sympt√¥mes m√©ritent une attention m√©dicale. Nous recommandons un examen ophtalmologique complet incluant :\n- Fond d'≈ìil\n- Mesure de la pression intraoculaire\n- Test du champ visuel\n- OCT (Tomographie par Coh√©rence Optique) si n√©cessaire\n\nConsultation recommand√©e dans les 2-4 semaines.`;
      } else {
        diagnostic = `‚úÖ Diagnostic : Pas de signes alarmants majeurs.\n\n${risques.length > 0 ? '√âl√©ments √† surveiller : ' + risques.join(', ') + '.\n\n' : ''}Maintenez une surveillance r√©guli√®re, surtout si vous avez des ant√©c√©dents familiaux. Examen de contr√¥le annuel recommand√© apr√®s 40 ans, semestriel apr√®s 60 ans.`;
      }
    }
    else if (quizId === 'sante-oculaire') {
      // Quiz V√©rification de Sant√© Oculaire (12 questions)
      let bonnesPratiques = 0;
      let mauvaisesHabitudes = [];

      // Q0: Fr√©quence consultations
      if (userAnswers[0] === 'a' || userAnswers[0] === 'b') bonnesPratiques++;
      else mauvaisesHabitudes.push("consultations irr√©guli√®res");

      // Q1: Protection UV
      if (userAnswers[1] === 'a') bonnesPratiques++;
      else mauvaisesHabitudes.push("protection UV insuffisante");

      // Q2: Ant√©c√©dents familiaux (info, pas de score)

      // Q3: Tabagisme
      if (userAnswers[3] === 'a') bonnesPratiques++;
      else mauvaisesHabitudes.push("exposition fum√©e");

      // Q4: Activit√© physique
      if (userAnswers[4] === 'a') bonnesPratiques++;
      else mauvaisesHabitudes.push("s√©dentarit√©");

      // Q5: Alimentation
      if (userAnswers[5] === 'a') bonnesPratiques++;
      else mauvaisesHabitudes.push("carences nutritionnelles");

      // Q6: Sommeil
      if (userAnswers[6] === 'a') bonnesPratiques++;
      else mauvaisesHabitudes.push("manque de sommeil");

      // Q7: Temps √©cran
      if (userAnswers[7] === 'c') {
        mauvaisesHabitudes.push("surexposition √©crans (>6h/jour)");
      } else if (userAnswers[7] === 'a') {
        bonnesPratiques++;
      }

      // Q8: √âclairage adapt√©
      if (userAnswers[8] === 'a') bonnesPratiques++;
      else mauvaisesHabitudes.push("√©clairage inadapt√©");

      // Q9: Hydratation
      if (userAnswers[9] === 'a') bonnesPratiques++;
      else mauvaisesHabitudes.push("d√©shydratation");

      // Q10: Nettoyage lunettes/lentilles
      if (userAnswers[10] === 'a') bonnesPratiques++;
      else mauvaisesHabitudes.push("hygi√®ne insuffisante");

      // Q11: Pauses √©cran
      if (userAnswers[11] === 'a') bonnesPratiques++;
      else mauvaisesHabitudes.push("absence de pauses visuelles");

      const scoreHygiene = (bonnesPratiques / 12) * 100;

      if (scoreHygiene >= 70) {
        diagnostic = `üåü Excellent ! Hygi√®ne de vie oculaire exemplaire.\n\nVous appliquez ${bonnesPratiques} bonnes pratiques sur 12. Continuez ainsi ! Votre mode de vie prot√®ge efficacement votre capital visuel √† long terme.\n\nPoints forts : Consultations r√©guli√®res, protection solaire, mode de vie sain.\n\nMaintenez ces habitudes pour pr√©venir les pathologies li√©es √† l'√¢ge (DMLA, cataracte, glaucome).`;
      } else if (scoreHygiene >= 40) {
        diagnostic = `üìà Diagnostic : Habitudes √† am√©liorer.\n\nVous pratiquez ${bonnesPratiques}/12 bonnes habitudes. Points √† corriger :\n${mauvaisesHabitudes.map(h => '‚Ä¢ ' + h).join('\n')}\n\nCes facteurs augmentent vos risques de pathologies oculaires. Adoptez progressivement de meilleures habitudes : protection UV syst√©matique, alimentation riche en antioxydants, pauses √©cran r√©guli√®res, hydratation suffisante.\n\nUne consultation permettra d'√©valuer l'impact actuel sur votre sant√© oculaire.`;
      } else {
        diagnostic = `üö® Alerte : Hygi√®ne de vie pr√©occupante pour vos yeux.\n\nSeulement ${bonnesPratiques}/12 bonnes pratiques. Probl√®mes identifi√©s :\n${mauvaisesHabitudes.map(h => '‚Ä¢ ' + h).join('\n')}\n\nVotre mode de vie actuel vous expose √† des risques √©lev√©s de pathologies oculaires pr√©coces. Changements urgents n√©cessaires :\n- Consultation ophtalmologique compl√®te\n- Protection UV syst√©matique\n- Alimentation enrichie (vitamines A, C, E, om√©ga-3)\n- R√©duction du temps d'√©cran\n- Hydratation (1,5-2L/jour)\n\nUne prise en charge globale est n√©cessaire.`;
      }
    }
    else if (quizId === 'selection-lentilles') {
      // Quiz S√©lection de Lentilles (11 questions)
      let profil = {
        duree: userAnswers[0],
        sensibilite: userAnswers[1],
        type: userAnswers[2],
        sport: userAnswers[3],
        environnement: userAnswers[4],
        experience: userAnswers[5],
        entretien: userAnswers[6],
        couleur: userAnswers[7],
        astigmatisme: userAnswers[8],
        sommeil: userAnswers[9],
        budget: userAnswers[10]
      };

      diagnostic = "üëÅÔ∏è Recommandation de lentilles personnalis√©e :\n\n";

      // Analyse de la dur√©e de port
      if (profil.duree === 'c') {
        diagnostic += "‚ö†Ô∏è Port prolong√© (>12h) : Privil√©giez des lentilles en silicone hydrogel haute perm√©abilit√© √† l'oxyg√®ne.\n";
      } else if (profil.duree === 'b') {
        diagnostic += "‚úÖ Port standard (8-12h) : Lentilles mensuelles ou journali√®res selon votre budget.\n";
      }

      // Sensibilit√©
      if (profil.sensibilite === 'a' || profil.sensibilite === 'b') {
        diagnostic += "‚ö†Ô∏è Yeux sensibles : Lentilles journali√®res recommand√©es (plus hygi√©niques), avec agent hydratant.\n";
      }

      // Type recommand√©
      if (profil.type === 'a') {
        diagnostic += "‚Ä¢ Votre choix : Journali√®res - Excellentes pour l'hygi√®ne et le confort.\n";
      } else if (profil.type === 'b') {
        diagnostic += "‚Ä¢ Votre choix : Mensuelles - Bon compromis √©conomie/confort si entretien rigoureux.\n";
      }

      // Sport
      if (profil.sport === 'a') {
        diagnostic += "‚Ä¢ Activit√© sportive intense : Les lentilles sont id√©ales ! Meilleur champ visuel que les lunettes.\n";
      }

      // Environnement
      if (profil.environnement === 'a' || profil.environnement === 'b') {
        diagnostic += "‚ö†Ô∏è Environnement sec (climatisation/chauffage) : Utilisez des larmes artificielles compatibles lentilles.\n";
      }

      // Astigmatisme
      if (profil.astigmatisme === 'a') {
        diagnostic += "‚Ä¢ Astigmatisme : Lentilles toriques n√©cessaires (plus ch√®res mais indispensables).\n";
      }

      // Sommeil
      if (profil.sommeil === 'b' || profil.sommeil === 'c') {
        diagnostic += "üö® DANGER : Ne JAMAIS dormir avec des lentilles classiques ! Risque majeur d'infection corn√©enne.\n";
      }

      // Budget
      if (profil.budget === 'a') {
        diagnostic += "\nüí∞ Budget <15k/mois : Lentilles mensuelles + solution (si entretien rigoureux possible).\n";
      } else if (profil.budget === 'b') {
        diagnostic += "\nüí∞ Budget 15-30k/mois : Lentilles journali√®res recommand√©es pour confort et hygi√®ne optimaux.\n";
      }

      diagnostic += "\nüìç Rendez-vous pour essai gratuit et formation √† la pose/d√©pose requis avant tout port.";
    }
    else if (quizId === 'prevention-fatigue') {
      // Quiz Pr√©vention de Fatigue Oculaire (10 questions)
      let risquesFatigue = [];
      let bonnesPratiques = 0;

      if (userAnswers[0] === 'c') risquesFatigue.push("temps d'√©cran excessif (>8h)");
      if (userAnswers[1] === 'a') bonnesPratiques++; else risquesFatigue.push("r√®gle 20-20-20 non appliqu√©e");
      if (userAnswers[2] === 'a') bonnesPratiques++; else risquesFatigue.push("distance √©cran inadapt√©e");
      if (userAnswers[3] === 'c') risquesFatigue.push("clignements insuffisants");
      if (userAnswers[4] === 'a') bonnesPratiques++; else risquesFatigue.push("√©cran mal positionn√©");
      if (userAnswers[5] === 'c') risquesFatigue.push("√©clairage inadapt√©");
      if (userAnswers[6] === 'c') risquesFatigue.push("absence de filtre lumi√®re bleue");
      if (userAnswers[7] === 'c') risquesFatigue.push("pas d'exercices oculaires");
      if (userAnswers[8] === 'b' || userAnswers[8] === 'c') risquesFatigue.push("mauvaise posture");
      if (userAnswers[9] === 'c') risquesFatigue.push("absence de pauses");

      if (risquesFatigue.length >= 6) {
        diagnostic = `üö® Risque √©lev√© de syndrome de vision informatique !\n\nFacteurs de risque identifi√©s (${risquesFatigue.length}/10) :\n${risquesFatigue.map(r => '‚Ä¢ ' + r).join('\n')}\n\nSympt√¥mes probables : yeux secs, rouges, irrit√©s, vision floue temporaire, maux de t√™te, douleurs cervicales.\n\nActions urgentes :\n‚úì Verres anti-lumi√®re bleue\n‚úì R√®gle 20-20-20 obligatoire (toutes les 20min, regarder √† 20m pendant 20sec)\n‚úì √âcran √† 50-70cm, l√©g√®rement sous le niveau des yeux\n‚úì √âclairage ambiant adapt√© (pas de reflets sur l'√©cran)\n‚úì Pauses de 5-10min toutes les heures\n‚úì Consultation pour v√©rifier correction visuelle\n\nSi non trait√© : risque de fatigue chronique et aggravation des sympt√¥mes.`;
      } else if (risquesFatigue.length >= 3) {
        diagnostic = `‚ö†Ô∏è Fatigue oculaire mod√©r√©e probable.\n\nPoints √† am√©liorer (${risquesFatigue.length}/10) :\n${risquesFatigue.map(r => '‚Ä¢ ' + r).join('\n')}\n\nVous avez d√©j√† ${bonnesPratiques} bonnes pratiques. Compl√©tez votre pr√©vention :\n‚Ä¢ Appliquez syst√©matiquement la r√®gle 20-20-20\n‚Ä¢ V√©rifiez la position et distance de votre √©cran\n‚Ä¢ Am√©liorez votre √©clairage (lumi√®re naturelle + lampe d'appoint)\n‚Ä¢ Clignez volontairement plus souvent\n‚Ä¢ Envisagez des verres avec filtre anti-lumi√®re bleue\n\nUne consultation permettra d'exclure un besoin de correction.`;
      } else {
        diagnostic = `‚úÖ Excellente pr√©vention de la fatigue oculaire !\n\nVous appliquez ${bonnesPratiques} bonnes pratiques. ${risquesFatigue.length > 0 ? 'Points mineurs √† peaufiner : ' + risquesFatigue.join(', ') : 'Continuez ainsi !'}\n\nVotre vigilance vous prot√®ge efficacement du syndrome de vision informatique. Maintenez ces habitudes et restez attentif √† tout nouveau sympt√¥me (s√©cheresse, fatigue inhabituelle).`;
      }
    }
    else if (quizId === 'selection-traitement') {
      // Quiz S√©lection de Traitement (13 questions)
      let candidatureChirurgie = 0;
      let contreIndications = [];
      let avantages = [];

      // Question 1: Int√©r√™t pour la chirurgie
      if (userAnswers[1] === 'a') {
        candidatureChirurgie += 3;
        avantages.push("forte motivation");
      } else if (userAnswers[1] === 'b') {
        candidatureChirurgie += 1;
      }

      // Question 2: Stabilit√© correction (crit√®re majeur)
      if (userAnswers[2] === 'a') {
        candidatureChirurgie += 3;
        avantages.push("correction stable");
      } else {
        contreIndications.push("correction instable (attendre stabilisation 2 ans)");
        candidatureChirurgie -= 2;
      }

      // Question 3: √Çge
      if (userAnswers[3] === 'a') {
        candidatureChirurgie += 2;
        avantages.push("√¢ge appropri√©");
      } else {
        contreIndications.push("√¢ge insuffisant (<18 ans)");
        candidatureChirurgie -= 3;
      }

      // Question 4: √âpaisseur corn√©e
      if (userAnswers[4] === 'b') {
        contreIndications.push("corn√©e trop fine (risque ectasie)");
        candidatureChirurgie -= 2;
      } else if (userAnswers[4] === 'a') {
        avantages.push("√©paisseur corn√©enne normale");
        candidatureChirurgie += 2;
      }

      // Question 5: Maladies
      if (userAnswers[5] === 'b' || userAnswers[5] === 'c') {
        contreIndications.push("maladies syst√©miques (contre-indication relative)");
        candidatureChirurgie -= 2;
      }

      // Question 6: Acceptation des risques
      if (userAnswers[6] === 'a') {
        candidatureChirurgie += 2;
        avantages.push("consentement √©clair√©");
      } else if (userAnswers[6] === 'c') {
        contreIndications.push("r√©ticence aux risques chirurgicaux");
        candidatureChirurgie -= 3;
      }

      // Question 8: Disponibilit√© repos
      if (userAnswers[8] === 'c') {
        contreIndications.push("pas de disponibilit√© post-op√©ratoire");
        candidatureChirurgie -= 1;
      }

      // Question 9: Attentes r√©alistes
      if (userAnswers[9] === 'b') {
        contreIndications.push("attentes irr√©alistes (risque insatisfaction)");
        candidatureChirurgie -= 2;
      } else if (userAnswers[9] === 'a') {
        avantages.push("attentes r√©alistes");
        candidatureChirurgie += 2;
      }

      // Question 11: Pr√©f√©rence type correction
      if (userAnswers[11] === 'b') {
        candidatureChirurgie -= 2;
      }

      // Question 12: Suivi post-op
      if (userAnswers[12] === 'c') {
        contreIndications.push("refus de suivi post-op√©ratoire");
        candidatureChirurgie -= 2;
      }

      // G√©n√©rer le diagnostic selon le score
      if (candidatureChirurgie >= 8 && contreIndications.length === 0) {
        diagnostic = `‚úÖ Excellent candidat pour la chirurgie r√©fractive !\n\nScore d'√©ligibilit√© : ${candidatureChirurgie}/15\n\nPoints positifs identifi√©s :\n${avantages.map(a => '‚úì ' + a).join('\n')}\n\nRecommandations :\n`;

        // Type de chirurgie recommand√© selon Q7
        if (userAnswers[7] === 'a') {
          diagnostic += `‚Ä¢ LASIK : Technique de r√©f√©rence, r√©cup√©ration rapide (24-48h), confort optimal.\n`;
        } else if (userAnswers[7] === 'b') {
          diagnostic += `‚Ä¢ PKR : Id√©al si corn√©e fine, s√©curit√© maximale, r√©cup√©ration plus longue (5-7 jours).\n`;
        } else if (userAnswers[7] === 'c') {
          diagnostic += `‚Ä¢ Implants phakes : Pour fortes myopies, r√©versible, excellents r√©sultats.\n`;
        }

        // Budget Q10
        if (userAnswers[10] === 'a') {
          diagnostic += `‚Ä¢ Votre budget (500k-1M FCFA/≈ìil) permet d'acc√©der aux meilleures technologies.\n`;
        } else if (userAnswers[10] === 'c') {
          diagnostic += `‚Ä¢ Votre budget (>1M FCFA/≈ìil) permet les techniques premium (Femtosecond, guidage aberrom√©trique).\n`;
        }

        diagnostic += `\nüè• Prochaines √©tapes :\n1. Bilan pr√©-op√©ratoire complet (topographie corn√©enne, pachym√©trie)\n2. Consultation avec chirurgien ophtalmologiste\n3. Explication d√©taill√©e des risques/b√©n√©fices\n4. Planification de l'intervention`;
      }
      else if (candidatureChirurgie >= 3 && candidatureChirurgie < 8) {
        diagnostic = `‚ö†Ô∏è Candidature possible avec r√©serves.\n\nScore d'√©ligibilit√© : ${candidatureChirurgie}/15\n\n`;

        if (contreIndications.length > 0) {
          diagnostic += `Points bloquants √† r√©soudre :\n${contreIndications.map(c => '‚ö†Ô∏è ' + c).join('\n')}\n\n`;
        }

        if (avantages.length > 0) {
          diagnostic += `Points positifs :\n${avantages.map(a => '‚úì ' + a).join('\n')}\n\n`;
        }

        diagnostic += `Recommandations :\n`;

        // Conseils sp√©cifiques selon les contre-indications
        if (contreIndications.some(c => c.includes('instable'))) {
          diagnostic += `‚Ä¢ Attendez 2 ans de stabilit√© compl√®te de votre correction\n`;
        }
        if (contreIndications.some(c => c.includes('corn√©e'))) {
          diagnostic += `‚Ä¢ Privil√©giez PKR ou implants phakes (pr√©servation corn√©enne)\n`;
        }
        if (contreIndications.some(c => c.includes('attentes'))) {
          diagnostic += `‚Ä¢ Informez-vous davantage : r√©sultat optimal ne garantit pas 10/10\n`;
        }
        if (contreIndications.some(c => c.includes('maladies'))) {
          diagnostic += `‚Ä¢ Contr√¥le strict de votre pathologie avant toute chirurgie\n`;
        }

        diagnostic += `\nüìã Action imm√©diate : Consultation d'√©valuation pour examen d√©taill√© de votre cas. Alternatives (lunettes progressives, lentilles) √† consid√©rer.`;
      }
      else {
        diagnostic = `üö´ Candidature non recommand√©e actuellement.\n\nScore d'√©ligibilit√© : ${candidatureChirurgie}/15 (seuil minimum non atteint)\n\n`;

        if (contreIndications.length > 0) {
          diagnostic += `Contre-indications majeures identifi√©es :\n${contreIndications.map(c => '‚ùå ' + c).join('\n')}\n\n`;
        }

        diagnostic += `Pourquoi la chirurgie n'est pas adapt√©e actuellement :\n`;

        if (userAnswers[1] === 'c') {
          diagnostic += `‚Ä¢ Vous n'√™tes pas int√©ress√©(e) par la chirurgie ‚Üí Les lunettes/lentilles restent d'excellentes solutions\n`;
        }
        if (userAnswers[3] !== 'a') {
          diagnostic += `‚Ä¢ √Çge insuffisant ‚Üí Attendez 18 ans minimum (id√©alement 21-25 ans)\n`;
        }
        if (userAnswers[2] !== 'a') {
          diagnostic += `‚Ä¢ Correction instable ‚Üí Toute chirurgie serait inefficace si la vue continue d'√©voluer\n`;
        }
        if (userAnswers[6] === 'c') {
          diagnostic += `‚Ä¢ R√©ticence aux risques ‚Üí Prudence l√©gitime, pas de chirurgie sans acceptation totale\n`;
        }

        diagnostic += `\n‚úÖ Solutions alternatives recommand√©es :\n`;
        diagnostic += `‚Ä¢ Lunettes : Large choix esth√©tique, sans risque, √©volutif\n`;
        diagnostic += `‚Ä¢ Lentilles : Libert√© de mouvement, champ visuel complet\n`;
        diagnostic += `‚Ä¢ Orthok√©ratologie : Lentilles de nuit pour corriger temporairement (myopie l√©g√®re)\n`;

        diagnostic += `\n\nüí° Vous pourrez r√©√©valuer votre candidature dans quelques ann√©es si votre situation √©volue.`;
      }
    }
    else {
      // Diagnostic g√©n√©rique pour les autres quiz
      diagnostic = `üìä Analyse de vos r√©ponses termin√©e.\n\nMerci d'avoir compl√©t√© ce quiz. Vos r√©ponses ont √©t√© enregistr√©es et analys√©es. Pour un diagnostic personnalis√© plus approfondi et des recommandations sp√©cifiques √† votre situation, nous vous invitons √† prendre rendez-vous avec nos sp√©cialistes.\n\nNos opticiens dipl√¥m√©s pourront r√©pondre pr√©cis√©ment √† vos besoins et vous orienter vers les meilleures solutions.`;
    }

    resultMessage.value = diagnostic;
    isCalculating.value = false;
    quizCompleted.value = true;

    // Scroll vers les r√©sultats
    setTimeout(() => {
      const section = document.querySelector('#quiz-test-section');
      if (section) {
        section.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }, 100);
  }, 8000);
};

const resetQuiz = () => {
  answers.value = new Array(questions.value.length).fill(null);
  quizCompleted.value = false;
  resultMessage.value = '';
  currentQuestionPage.value = 0;
};

// --- Logique des Tests (envoi par email) ---
const submitTest = () => {
  if (!testFormData.value.name || !testFormData.value.email) return;

  // Simuler l'envoi au backend
  console.log('Test soumis:', {
    test: selectedTestType.value.title,
    formData: testFormData.value
  });

  // TODO: Int√©grer avec l'API backend pour envoyer r√©ellement
  // await api.submitTest({...})

  testSubmitted.value = true;
};

const resetTestForm = () => {
  testFormVisible.value = false;
  testSubmitted.value = false;
  testFormData.value = {
    name: '',
    email: '',
    phone: ''
  };
  selectedTestType.value = null;
};


// --- Data et Logique pour la FAQ ---
const faqItems = ref([
  { question: "Quelle est la fr√©quence recommand√©e pour un examen de vue ?", answer: "G√©n√©ralement, une fois tous les deux ans. Toutefois, pour les enfants ou les personnes de plus de 65 ans, un examen annuel est souvent conseill√©.", open: false },
  { question: "Qu'est-ce que le filtre anti-lumi√®re bleue ?", answer: "C'est un traitement de surface qui filtre une partie de la lumi√®re bleue-violette √©mise par les √©crans num√©riques (t√©l√©phones, ordinateurs) pour r√©duire la fatigue oculaire.", open: false },
  { question: "Combien de temps faut-il pour s'habituer √† de nouveaux verres progressifs ?", answer: "La p√©riode d'adaptation varie, mais elle est g√©n√©ralement de quelques jours √† deux semaines. Nous sommes l√† pour vous accompagner si des difficult√©s persistent.", open: false },
  { question: "Puis-je utiliser une vieille ordonnance ?", answer: "Une ordonnance a g√©n√©ralement une validit√© limit√©e (souvent 3 ou 5 ans). Pour un renouvellement optimal, nous vous conseillons de planifier un examen de vue r√©cent.", open: false },
]);

const toggleFaq = (index) => {
  faqItems.value[index].open = !faqItems.value[index].open;
};

// --- Data et Logique pour le Formulaire de Conseil ---
const adviceForm = ref({
  name: '',
  email: '',
  phone: '',
  subject: '',
  message: ''
});

const adviceSending = ref(false);
const adviceStatus = ref({
  show: false,
  success: false,
  message: ''
});

const isAdviceFormValid = computed(() => {
  return adviceForm.value.name.trim() !== '' &&
    adviceForm.value.email.trim() !== '' &&
    adviceForm.value.subject !== '' &&
    adviceForm.value.message.trim().length >= 20;
});

const sendAdviceRequest = async () => {
  if (!isAdviceFormValid.value) return;

  adviceSending.value = true;
  adviceStatus.value.show = false;

  try {
    // Simulation d'envoi d'email (√† remplacer par votre API)
    await new Promise(resolve => setTimeout(resolve, 1500));

    // Ici, vous pouvez int√©grer votre service d'envoi d'email
    // Par exemple avec EmailJS ou votre backend API
    console.log('Demande de conseil:', adviceForm.value);

    adviceStatus.value = {
      show: true,
      success: true,
      message: '‚ú® Votre demande a √©t√© envoy√©e avec succ√®s ! Nos experts vous r√©pondront dans les 24h par email.'
    };

    // R√©initialiser le formulaire
    adviceForm.value = {
      name: '',
      email: '',
      phone: '',
      subject: '',
      message: ''
    };

  } catch (error) {
    adviceStatus.value = {
      show: true,
      success: false,
      message: '‚ùå Une erreur est survenue. Veuillez r√©essayer ou nous contacter directement.'
    };
  } finally {
    adviceSending.value = false;

    // Masquer le message apr√®s 5 secondes
    setTimeout(() => {
      adviceStatus.value.show = false;
    }, 5000);
  }
};

// --- Fonctions de validation ---
const validateEmail = () => {
  const email = testFormData.value.email;
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

  if (!email) {
    emailError.value = '';
    return false;
  }

  if (!emailRegex.test(email)) {
    emailError.value = 'Format d\'email invalide';
    return false;
  }

  emailError.value = '';
  return true;
};

const validatePhone = () => {
  const phone = testFormData.value.phone;

  if (!phone) {
    phoneError.value = '';
    return true; // Optionnel
  }

  // Supprimer tous les espaces et caract√®res sp√©ciaux pour la validation
  const cleanPhone = phone.replace(/[\s\-\(\)]/g, '');

  // Format accept√©: +221XXXXXXXXX, 221XXXXXXXXX, ou XXXXXXXXX (9 chiffres minimum)
  const phoneRegex = /^(\+?221)?[0-9]{9,10}$/;

  if (!phoneRegex.test(cleanPhone)) {
    phoneError.value = 'Format invalide (ex: 77 123 45 67)';
    return false;
  }

  phoneError.value = '';
  return true;
};

// Computed pour validation du formulaire
const isFormValid = computed(() => {
  return testFormData.value.name &&
    testFormData.value.email &&
    !emailError.value;
});

// --- Sauvegarde et r√©cup√©ration de progression ---
const saveProgressToLocalStorage = () => {
  try {
    const progressData = {
      // Quiz
      selectedQuizType: selectedQuizType.value,
      questions: questions.value,
      answers: answers.value,
      currentQuestionPage: currentQuestionPage.value,
      quizCompleted: quizCompleted.value,

      // Test
      selectedTestType: selectedTestType.value,
      testFormData: testFormData.value,
      testFormSubmitted: testFormSubmitted.value,
      testAnswers: testAnswers.value,
      currentTestStep: currentTestStep.value,
      testCompleted: testCompleted.value,

      timestamp: new Date().getTime()
    };

    localStorage.setItem('quizAdviceProgress', JSON.stringify(progressData));
  } catch (error) {
    console.error('Erreur sauvegarde localStorage:', error);
  }
};

const loadProgressFromLocalStorage = () => {
  try {
    const savedData = localStorage.getItem('quizAdviceProgress');
    if (!savedData) return;

    const progressData = JSON.parse(savedData);
    const now = new Date().getTime();
    const oneHour = 60 * 60 * 1000;

    // V√©rifier si les donn√©es ont moins d'1 heure
    if (now - progressData.timestamp < oneHour) {
      // Restaurer les donn√©es
      if (progressData.selectedQuizType) {
        selectedQuizType.value = progressData.selectedQuizType;
        questions.value = progressData.questions || [];
        answers.value = progressData.answers || [];
        currentQuestionPage.value = progressData.currentQuestionPage || 0;
        quizCompleted.value = progressData.quizCompleted || false;
      }

      if (progressData.selectedTestType) {
        selectedTestType.value = progressData.selectedTestType;
        testFormData.value = progressData.testFormData;
        testFormSubmitted.value = progressData.testFormSubmitted;
        testAnswers.value = progressData.testAnswers;
        currentTestStep.value = progressData.currentTestStep;
        testCompleted.value = progressData.testCompleted;
      }

      console.log('‚úÖ Progression restaur√©e');
    } else {
      // Donn√©es trop anciennes, les supprimer
      localStorage.removeItem('quizAdviceProgress');
    }
  } catch (error) {
    console.error('Erreur chargement localStorage:', error);
    localStorage.removeItem('quizAdviceProgress');
  }
};

const clearProgressFromLocalStorage = () => {
  localStorage.removeItem('quizAdviceProgress');
};

// --- Watchers pour sauvegarder automatiquement ---
watch([
  answers,
  currentQuestionPage,
  currentTestStep,
  testAnswers,
  testFormSubmitted,
  selectedQuizType,
  selectedTestType
], () => {
  saveProgressToLocalStorage();
}, { deep: true });

// --- Lifecycle hooks ---
onMounted(() => {
  // Charger la progression sauvegard√©e
  loadProgressFromLocalStorage();

  // Ajouter navigation clavier (accessibilit√©)
  document.addEventListener('keydown', handleKeyboardNavigation);
});

const handleKeyboardNavigation = (e) => {
  // Navigation dans les quiz avec les fl√®ches
  if (selectedQuizType.value && !quizCompleted.value) {
    if (e.key === 'ArrowRight' && isCurrentPageValid.value) {
      nextPage();
    } else if (e.key === 'ArrowLeft' && currentQuestionPage.value > 0) {
      previousPage();
    }
  }

  // Navigation dans les tests
  if (selectedTestType.value && testFormSubmitted.value && !testCompleted.value) {
    if (e.key === 'ArrowRight' && testAnswers.value[currentTestStep.value]) {
      nextTestStep();
    } else if (e.key === 'ArrowLeft' && currentTestStep.value > 0) {
      previousTestStep();
    }
  }
};

// Fonction pour marquer que les r√©sultats du quiz ont √©t√© envoy√©s
const markQuizResultSent = () => {
  quizResultSent.value = true;

  // Simuler l'envoi d'email
  setTimeout(() => {
    console.log('üìß R√©sultats du quiz envoy√©s par email');
  }, 1000);
};

// Appeler cette fonction apr√®s l'affichage des r√©sultats
watch(quizCompleted, (newVal) => {
  if (newVal) {
    setTimeout(() => {
      markQuizResultSent();
    }, 2000); // Attendre 2s apr√®s l'affichage des r√©sultats
  }
});
</script>

<style scoped>
@keyframes progressBar {
  0% {
    width: 0%;
  }

  100% {
    width: 100%;
  }
}

/* Animation de pulsation pour le spinner */
@keyframes pulse {

  0%,
  100% {
    opacity: 1;
  }

  50% {
    opacity: 0.5;
  }
}

/* Animation de ping pour les points */
@keyframes ping {

  75%,
  100% {
    transform: scale(2);
    opacity: 0;
  }
}

/* Animation de fade-in pour les messages */
@keyframes fade-in {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-fade-in {
  animation: fade-in 0.5s ease-out;
}

/* Transitions fluides entre les √©tapes */
.test-step-enter-active,
.test-step-leave-active {
  transition: all 0.3s ease;
}

.test-step-enter-from {
  opacity: 0;
  transform: translateX(30px);
}

.test-step-leave-to {
  opacity: 0;
  transform: translateX(-30px);
}

/* Responsive pour SVG sur mobile */
@media (max-width: 640px) {
  svg {
    max-width: 100% !important;
    height: auto !important;
  }
}

/* Focus visible pour accessibilit√© */
button:focus-visible,
input:focus-visible {
  outline: 2px solid #3b82f6;
  outline-offset: 2px;
}

/* Animation pour les boutons de r√©ponse */
button {
  transition: all 0.2s ease;
}

button:active {
  transform: scale(0.98);
}
</style>
